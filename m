Return-Path: <linux-arch-owner@vger.kernel.org>
X-Original-To: lists+linux-arch@lfdr.de
Delivered-To: lists+linux-arch@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id C427D2873D8
	for <lists+linux-arch@lfdr.de>; Thu,  8 Oct 2020 14:12:49 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1725852AbgJHMMs (ORCPT <rfc822;lists+linux-arch@lfdr.de>);
        Thu, 8 Oct 2020 08:12:48 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:35478 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1725802AbgJHMMs (ORCPT
        <rfc822;linux-arch@vger.kernel.org>); Thu, 8 Oct 2020 08:12:48 -0400
Received: from mail-pf1-x442.google.com (mail-pf1-x442.google.com [IPv6:2607:f8b0:4864:20::442])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 6C770C061755
        for <linux-arch@vger.kernel.org>; Thu,  8 Oct 2020 05:12:48 -0700 (PDT)
Received: by mail-pf1-x442.google.com with SMTP id b26so3838429pff.3
        for <linux-arch@vger.kernel.org>; Thu, 08 Oct 2020 05:12:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=date:message-id:from:to:cc:subject:in-reply-to:references
         :user-agent:mime-version;
        bh=avG2U10/AnQ/HuFS35BR605fPu8n7fRYwK0Lc55PWYs=;
        b=guONkQ30Axu0+l9tWpZfm1B/X9K6/3AUThWhxSAZyl0M/ZMXdhNYFIAa33/Pq1K4zf
         IYjw2f7jd8eKzo29oNWlUzFhz9FaIfzaDCh/ZNeRKA0Sv8cjNk9UPrXUhrrm/XxRsOYM
         Co7ox/5N9SGRGaRYLIvJkV5Rbi4SKd2622xOgxaQGwjnRDtYdyXm5MACMJtgrCArDky8
         qaktfNvuCJygYsMFQXzsk8Y786aUB66a2oVH4R3YmEmrs8B5a0wCU68v6+Wvs0QmqWe7
         ghWTZcA665CjWvYrdxcDEyFcvmqteqjYcuxEjrGohlB/5A4lWMwTuQGNocvOJtZJw5G8
         nckQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:date:message-id:from:to:cc:subject:in-reply-to
         :references:user-agent:mime-version;
        bh=avG2U10/AnQ/HuFS35BR605fPu8n7fRYwK0Lc55PWYs=;
        b=Q+HrZmKewrfGQJ9jYT3L/G/nxXEDiKtwzUBOq6Y3ZyvL5xFfngXvcQyk703RrDKGkB
         K0OSpCbvYSDgQ3nGxN7PzVjuqVV4nHsH/5b2fmUO3hUTm+jNTg7vjeNASGzijCQTZYn+
         uhvAwTUns0ZU3LqiPUtNPf3HKoJavy3TtHNkubxUoW65soNehImE6/vPR9lIoNQSIZnJ
         bAWgr5uyT3QBfoa6ogwQWVIVlXoS+ZaHpFRaDZr3iv91gUezwI2yML+pPc4HjaEFG17I
         eC8DgNherXnskQ/7wTxXRHra7FmYJTvySWvwLPWjlEhNpGg+DfR7roUrSVYTBRqlPGxf
         0W2w==
X-Gm-Message-State: AOAM532EdrrpTnAtZHYjbzFNfj8AXjwkxyDAYZGrYwAuYP5WGrAYxeN2
        RTj+fHKXqUgp4jeUHNahfiM=
X-Google-Smtp-Source: ABdhPJxQTQQ9ly+1xY6CKeBmVNmt8NlpvuEj/3zpLPeCsggIovvJYH72ZpZiorxwSB73RrCdLzMhlA==
X-Received: by 2002:a65:6487:: with SMTP id e7mr6916581pgv.409.1602159167577;
        Thu, 08 Oct 2020 05:12:47 -0700 (PDT)
Received: from earth-mac.local.gmail.com (219x123x138x129.ap219.ftth.ucom.ne.jp. [219.123.138.129])
        by smtp.gmail.com with ESMTPSA id bx22sm7036569pjb.40.2020.10.08.05.12.44
        (version=TLS1_2 cipher=ECDHE-ECDSA-CHACHA20-POLY1305 bits=256/256);
        Thu, 08 Oct 2020 05:12:46 -0700 (PDT)
Date:   Thu, 08 Oct 2020 21:12:40 +0900
Message-ID: <m2362o6hmv.wl-thehajime@gmail.com>
From:   Hajime Tazaki <thehajime@gmail.com>
To:     anton.ivanov@cambridgegreys.com
Cc:     linux-um@lists.infradead.org, jdike@addtoit.com, richard@nod.at,
        tavi.purdila@gmail.com, linux-kernel-library@freelists.org,
        linux-arch@vger.kernel.org, retrage01@gmail.com
Subject: Re: [RFC v7 00/21] Unifying LKL into UML
In-Reply-To: <1ba41b09-6bdb-2fb7-5696-7db429e0a6a5@cambridgegreys.com>
References: <cover.1600922528.git.thehajime@gmail.com>
        <cover.1601960644.git.thehajime@gmail.com>
        <1ba41b09-6bdb-2fb7-5696-7db429e0a6a5@cambridgegreys.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/25.3 Mule/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Precedence: bulk
List-ID: <linux-arch.vger.kernel.org>
X-Mailing-List: linux-arch@vger.kernel.org


Hello Anton,

On Wed, 07 Oct 2020 22:30:03 +0900,
Anton Ivanov wrote:
> 
> 
> On 06/10/2020 10:44, Hajime Tazaki wrote:
> > This is another spin of the unification of LKL into UML.  Based on the
> > discussion of v4 patchset, we have tried to address issue raised and
> > rewrote the patchset from scratch.  The summary is listed in the
> > changelog below.
> > 
> > Although there are still bugs in the patchset, we'd like to ask your
> > opinions on the design we changed.
> > 
> > The milestone section is also updated: this patchset is for the
> > milestone 1, though the common init API is still not implemented yet.
> > 
> > 
> > Changes in rfc v7:
> > - preserve `make ARCH=um` syntax to build UML
> > - introduce `make ARCH=um UMMODE=library` to build library mode
> > - fix undefined symbols issue during modpost
> > - clean up makefiles (arch/um, tools/um)
> 
> Hi Hajime, hi Tavi,
> 
> Our starting point should be that it does not break the existing build. It still does.

I agree with the starting point.

> If I build a "stock configuration" UML after applying the patchset
> the resulting vmlinux is not executable.

Ah, I confirmed the issue.
I was only trying to make the `linux` binary compatible, not vmlinux.

Because vmlinux is now build as a relocatable object, this is
something we need to figure out if we wish to keep vmlinux executable.

Do you think we should make vmlinux executable even if we have the
file linux executable ? If yes, we will work on this to fix the issue.

> On the positive side, it builds cleanly now. I will try to go
> through the rest of the patchset later today and see if there is
> anything else that needs fixing before we do the next version.

thanks for your time.

-- Hajime

