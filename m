Return-Path: <linux-arch-owner@vger.kernel.org>
X-Original-To: lists+linux-arch@lfdr.de
Delivered-To: lists+linux-arch@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id D162D371ED0
	for <lists+linux-arch@lfdr.de>; Mon,  3 May 2021 19:42:09 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231624AbhECRnB (ORCPT <rfc822;lists+linux-arch@lfdr.de>);
        Mon, 3 May 2021 13:43:01 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:36744 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S231523AbhECRnA (ORCPT
        <rfc822;linux-arch@vger.kernel.org>); Mon, 3 May 2021 13:43:00 -0400
Received: from mail-lf1-x12f.google.com (mail-lf1-x12f.google.com [IPv6:2a00:1450:4864:20::12f])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id BBE57C061761
        for <linux-arch@vger.kernel.org>; Mon,  3 May 2021 10:42:05 -0700 (PDT)
Received: by mail-lf1-x12f.google.com with SMTP id n138so9301086lfa.3
        for <linux-arch@vger.kernel.org>; Mon, 03 May 2021 10:42:05 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=linux-foundation.org; s=google;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to
         :cc;
        bh=JTrVhmqs0/THvWVizOAQ1V0Ua9ksOL1tR8elAhbdnDM=;
        b=NOm3b/yoMltjxbQo/V+8GYwfZgK7a6HqXVL2PTvEwRV/I2CPuGxS/zEbcki+juN1G+
         HxrENwT+dlZujbg8O/zL4/bTfRDFHyrP1weqkqJXSeP5GGStsZz7NSWK5fLH3S6OdBr2
         126zZXTP05NgOMxNIDS2U6ERUGk6V/SPPEPDA=
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:mime-version:references:in-reply-to:from:date
         :message-id:subject:to:cc;
        bh=JTrVhmqs0/THvWVizOAQ1V0Ua9ksOL1tR8elAhbdnDM=;
        b=JK7R9P9csJjUk2g8KhXg6A/sz6Ke7LsaIgMf+DUIoM//KE9GLsUqWpzKmznZLfVpBC
         XM0LNJ3hlfOpdasUbQdABRzuxnYsm3f2Mn+yBfgX5E7JPBy2Rf8D4GaXmST+z12qDBYt
         PoogxboVrc0g+Rf0ldsGWMI4n5mxINVWXOVU/om70EVIAsnhoBqr2o0oSMnlPn7A+IDF
         zdcDEPorqL+MLzImLTZXs+mLzFpFE6YInCZ+P21GKzxmAZLohMso+3fLHSsHinOsyBlD
         bLZHLViPBO4jvoGRxBFyfywBeFz/a9msTLiuLQdRYoV9EV6vAqAdEltl94gRbQ+8QYDd
         emXA==
X-Gm-Message-State: AOAM532bx8/6dJerA1xfMU0NznYg/vlTsT+qqtDlKbxQW232LzYVS8QN
        kMfCbH6yIUsZWoP0djjGJiBGE+urmuec/iHVrMk=
X-Google-Smtp-Source: ABdhPJxuvnkNkOOR+ucCDHIjsE7tAaBOSfPPzgPKhJbCDVUEXWlQFpYAMYrpC2wHLUvxVV3i9uL0sQ==
X-Received: by 2002:a19:771b:: with SMTP id s27mr14302898lfc.111.1620063723979;
        Mon, 03 May 2021 10:42:03 -0700 (PDT)
Received: from mail-lf1-f42.google.com (mail-lf1-f42.google.com. [209.85.167.42])
        by smtp.gmail.com with ESMTPSA id m26sm23673lfp.220.2021.05.03.10.42.01
        for <linux-arch@vger.kernel.org>
        (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
        Mon, 03 May 2021 10:42:02 -0700 (PDT)
Received: by mail-lf1-f42.google.com with SMTP id 124so9298916lff.5
        for <linux-arch@vger.kernel.org>; Mon, 03 May 2021 10:42:01 -0700 (PDT)
X-Received: by 2002:a05:6512:3763:: with SMTP id z3mr13360332lft.487.1620063721523;
 Mon, 03 May 2021 10:42:01 -0700 (PDT)
MIME-Version: 1.0
References: <75d07691-1e4f-741f-9852-38c0b4f520bc@synopsys.com>
In-Reply-To: <75d07691-1e4f-741f-9852-38c0b4f520bc@synopsys.com>
From:   Linus Torvalds <torvalds@linux-foundation.org>
Date:   Mon, 3 May 2021 10:41:45 -0700
X-Gmail-Original-Message-ID: <CAHk-=wi4Rgo7f17AwYduEPKr6SEVq-mxRJiZ5S5X0hQ9RWmkYA@mail.gmail.com>
Message-ID: <CAHk-=wi4Rgo7f17AwYduEPKr6SEVq-mxRJiZ5S5X0hQ9RWmkYA@mail.gmail.com>
Subject: Re: Heads up: gcc miscompiling initramfs zlib decompression code at -O3
To:     Vineet Gupta <Vineet.Gupta1@synopsys.com>
Cc:     Arnd Bergmann <arnd@kernel.org>,
        Peter Zijlstra <peterz@infradead.org>,
        Masahiro Yamada <masahiroy@kernel.org>,
        Jann Horn <jannh@google.com>,
        lkml <linux-kernel@vger.kernel.org>,
        arcml <linux-snps-arc@lists.infradead.org>,
        "linux-arch@vger.kernel.org" <linux-arch@vger.kernel.org>
Content-Type: multipart/mixed; boundary="000000000000a2b63c05c1707ab9"
Precedence: bulk
List-ID: <linux-arch.vger.kernel.org>
X-Mailing-List: linux-arch@vger.kernel.org

--000000000000a2b63c05c1707ab9
Content-Type: text/plain; charset="UTF-8"

On Fri, Apr 30, 2021 at 1:46 PM Vineet Gupta <Vineet.Gupta1@synopsys.com> wrote:
>
> I've hit a mainline gcc 10.2 (also gcc 9.3) bug which triggers at -O3
> causing wrong codegen.

So it does seem to be a gcc bug or at least mis-feature where gcc gets
the aliasing decision wrong when vectorizing the code.

That said, the fact that gcc even tries to vectorize the code shows
how pointless it was for us to (years ago) try to make it use 16-bit
accesses in the first place.

So can you try this patch that basically reverts some of those
kernel-specific changes to zlib's inffast.c - and does so by just
upgrading it to a newer version from a more modern zlib (which in this
case still means "from 2017", but that's the most recent version there
is).

This is a fairly quick hack, and I really tried to keep it to just
inffast.c and inftrees.c with a few minimal fixups to inflate.c
itself.

Most of the changes are for naming (which seems to be at least partly
for C++ namespace reasons, ie "this" -> "here"), but there's some
cleanup wrt maximum table sizes etc too.

NOTE! I have not tested this patch in any other way than "it compiles
with allmodconfig". The diff looks reasonable to me, but that's all
I'm really going to say.

Does this avoid the gcc -O3 problem for you?

It would be lovely if somebody also took a look at some of the other
zlib code, like inflate.c itself. But some of that code has rather
subtle changes for things like s390 hardware support, and we have
thihngs like our fallthrough rules etc, so it gets a bit hairier.

Which is why I did just this fairly minimal part.

Note that the commit message has a "Not-yet-signed-off-by:" from me.
That's purely because I wanted it to be obvious that this needs a lot
more testing - I'm not comfy with this patch unless somebody takes it
upon themselves to actually test it under different loads (and
different architectures).

                  Linus

--000000000000a2b63c05c1707ab9
Content-Type: text/x-patch; charset="US-ASCII"; 
	name="0001-Update-zlib-inffast-code-to-more-modern-zlib.patch"
Content-Disposition: attachment; 
	filename="0001-Update-zlib-inffast-code-to-more-modern-zlib.patch"
Content-Transfer-Encoding: base64
Content-ID: <f_ko8vy28w0>
X-Attachment-Id: f_ko8vy28w0

RnJvbSAzZWEyMTlhMTRiZDZmMzZkZmVkNWU0NjEwNjczNDlhYjg2YTAyOTM1IE1vbiBTZXAgMTcg
MDA6MDA6MDAgMjAwMQpGcm9tOiBMaW51cyBUb3J2YWxkcyA8dG9ydmFsZHNAbGludXgtZm91bmRh
dGlvbi5vcmc+CkRhdGU6IE1vbiwgMyBNYXkgMjAyMSAxMDoyNzozNCAtMDcwMApTdWJqZWN0OiBb
UEFUQ0hdIFVwZGF0ZSB6bGliIGluZmZhc3QgY29kZSB0byBtb3JlIG1vZGVybiB6bGliCgpUaGlz
IHVwZGF0ZXMgcGFydCBvZiBvdXIgemxpYiBpbmZsYXRlIGNvZGUgdG8gdGhlIG1vc3QgY3VycmVu
dCB6bGliCnNvdXJjZXMgYXMgb2YgemxpYiAxLjIuMTEgKHJlbGVhc2VkIGJ5IE1hcmsgQWRsZXIg
YmFjayBpbiAyMDE3KS4KClRoaXMgaXMgb25seSBhIHBhcnRpYWwgdXBkYXRlIHRvIGEgbW9yZSBt
b2Rlcm4gemxpYiBiYXNlLCBtYWlubHkgdG8gZ2V0CnRoZSBjdXJyZW50ICdpbmZmYXN0JyBhbmQg
J2luZnRyZWVzJyBjb2RlLiAgSW4gdGhlIHByb2Nlc3MsIHRoaXMKZWZmZWN0aXZlbHkgcmV2ZXJ0
cyBzb21lIG9mIG91ciBsb2NhbCBrZXJuZWwgb3B0aW1pemF0aW9ucyB0aGF0IGhhdmUKY2F1c2Vk
IHByb2JsZW1zLgoKSW4gcGFydGljdWxhciwgc2VlCgogICBodHRwczovL2djYy5nbnUub3JnL2J1
Z3ppbGxhL3Nob3dfYnVnLmNnaT9pZD0xMDAzNjMKCndoaWNoIGlzIChJIGFyZ3VlKSBhIGdjYyBi
dWcgb3IgYXQgbGVhc3QgbWlzLWZlYXR1cmUsIGJ1dCBpdCBkb2VzIHNob3cKaG93IHRoZSAxNi1i
aXQgYWNjZXNzIG9wdGltaXphdGlvbnMgdGhhdCBkbyBub3QgZXhpc3QgaW4gdXBzdHJlYW0gemxp
YgpoYXZlIGNhdXNlZCBwcm9ibGVtcy4KClRoZSBlZmZlY3RpdmVseSByZXZlcnRlZCBjb21taXRz
IGFyZQoKICA1MWVhM2Y2YTQ1NzEgKCJpbmZsYXRlX2Zhc3Q6IHNvdXQgaXMgYWxyZWFkeSBhIHNo
b3J0IHNvIHB0ciBhcml0aCB3YXMgb2ZmIGJ5IG9uZS4iKQogIGU2OWVhZTY1NTIzYiAoInpsaWI6
IG1ha2UgbmV3IG9wdGltaXplZCBpbmZsYXRlIGVuZGlhbiBpbmRlcGVuZGVudCIpCiAgNjg0NmVl
NWNhNjhkICgiemxpYjogRml4IGJ1aWxkIG9mIHBvd2VycGMgYm9vdCB3cmFwcGVyIikKICBhYzRj
MmEzYmJlNWQgKCJ6bGliOiBvcHRpbWl6ZSBpbmZmYXN0IHdoZW4gY29weWluZyBkaXJlY3QgZnJv
bSBvdXRwdXQiKQoKdGhhdCBkbyBub3QgZ2V0IGNhcnJpZWQgZm9yd2FyZCBieSB0aGlzIHVwZGF0
ZSB0byBhIG1vcmUgcmVjZW50IHZlcnNpb24Kb2YgaW50ZmZhc3QuYy4KCk5vdGUgdGhhdCBJJ3Zl
IHRyaWVkIHRvIGtlZXAgdGhlIGNoYW5nZXMgbWluaW1hbCB3cnQgdGhlIG9yaWdpbmFsIHpsaWIK
c291cmNlcywgYnV0IHRoZXJlIGFyZSBzb21lIGNoYW5nZXM6CgogLSBSZW1vdmFsIG9mIHNvbWUg
emxpYi1pbnRlcm5hbHM6CiAgICAtIG5vIG1vcmUgQVNNSU5GCiAgICAtIFpMSUJfSU5URVJOQUwK
ICAgIC0gbm8gVHJhY2V2digpIHRyYWNpbmcgY2FsbHMKCiAtIFJlbW92YWwgb2YgcG9ydGFiaWxp
dHkgY3J1ZCBmb3IgYW5jaWVudCBjb21waWxlcnM6CiAgICAtICJGQVIiIHBvaW50ZXIgbWFya2lu
Z3MKICAgIC0gdHVybmVkICJ6X2NvbnN0IiBpbnRvIGp1c3QgImNvbnN0IgogICAgLSBjb252ZXJ0
IGZ1bmN0aW9uIHByb3RvdHlwZXMgdG8gIm1vZGVybiIgQU5TSSBDIHJhdGhlciB0aGFuIEsmUiBz
eW50YXgKCiAtIHJlbW92ZWQgdW51c2VkICJnel9oZWFkZXJwIiBmcm9tIGluZmxhdGVfc3RhdGUK
CkFsc28gbm90ZSB0aGF0IHRoaXMgZG9lcyBjaGFuZ2UgaW5mbGF0ZS5jIG1pbmltYWxseTogaW4g
dGhlIHllYXJzIHNpbmNlCndlIHN5bmNyb25pemVkIHdpdGggdXBzdHJlYW0gemxpYiwgdGhlICct
PndyaXRlJyBtZW1iZXIgb2YgJ3N0cnVjdAppbmZsYXRlX3N0YXRlJyBoYXMgYmVlbiByZW5hbWVk
IHRvICctPnduZXh0Jy4gIEJ1dCB0aGlzIGRvZXMgKm5vdCoKdXBkYXRlIGFsbCBvZiBpbmZsYXRl
LmMgdG8gYSBuZXdlciB2ZXJzaW9uLCBiZWNhdXNlIHdlIGRvIGhhdmUgYWxvdCBvZgpsb2NhbCBj
aGFuZ2VzIGZvciBzdGF0aWMgd29ya3NwYWNlIGFsbG9jYXRpb25zLCBhbmQgZXZlbiBzcGVjaWFs
IHMzOTAKaGFyZHdhcmUgc3VwcG9ydC4KClRoaXMgd2lsbCBuZWVkIGxvdHMgb2YgdGVzdGluZy4K
Ck5vdC15ZXQtc2lnbmVkLW9mZi1ieTogTGludXMgVG9ydmFsZHMgPHRvcnZhbGRzQGxpbnV4LWZv
dW5kYXRpb24ub3JnPgotLS0KIGxpYi96bGliX2luZmxhdGUvaW5mZmFzdC5jICB8IDE2MiArKysr
KysrKysrKysrKysrLS0tLS0tLS0tLS0tLS0tLS0tLS0KIGxpYi96bGliX2luZmxhdGUvaW5mbGF0
ZS5jICB8ICAyNSArKystLS0KIGxpYi96bGliX2luZmxhdGUvaW5mbGF0ZS5oICB8ICA2NiArKysr
KysrKy0tLS0tLS0KIGxpYi96bGliX2luZmxhdGUvaW5mdHJlZXMuYyB8IDEwNyArKysrKysrKyst
LS0tLS0tLS0tLS0tLS0KIGxpYi96bGliX2luZmxhdGUvaW5mdHJlZXMuaCB8ICAzMSArKystLS0t
CiA1IGZpbGVzIGNoYW5nZWQsIDE4MCBpbnNlcnRpb25zKCspLCAyMTEgZGVsZXRpb25zKC0pCgpk
aWZmIC0tZ2l0IGEvbGliL3psaWJfaW5mbGF0ZS9pbmZmYXN0LmMgYi9saWIvemxpYl9pbmZsYXRl
L2luZmZhc3QuYwppbmRleCBlZDFmM2RmMjcyNjAuLmUzZDZmYjEwZDE5OCAxMDA2NDQKLS0tIGEv
bGliL3psaWJfaW5mbGF0ZS9pbmZmYXN0LmMKKysrIGIvbGliL3psaWJfaW5mbGF0ZS9pbmZmYXN0
LmMKQEAgLTEsNSArMSw1IEBACiAvKiBpbmZmYXN0LmMgLS0gZmFzdCBkZWNvZGluZwotICogQ29w
eXJpZ2h0IChDKSAxOTk1LTIwMDQgTWFyayBBZGxlcgorICogQ29weXJpZ2h0IChDKSAxOTk1LTIw
MTcgTWFyayBBZGxlcgogICogRm9yIGNvbmRpdGlvbnMgb2YgZGlzdHJpYnV0aW9uIGFuZCB1c2Us
IHNlZSBjb3B5cmlnaHQgbm90aWNlIGluIHpsaWIuaAogICovCiAKQEAgLTgsMjQgKzgsMTYgQEAK
ICNpbmNsdWRlICJpbmZsYXRlLmgiCiAjaW5jbHVkZSAiaW5mZmFzdC5oIgogCi0jaWZuZGVmIEFT
TUlORgotCi11bmlvbiB1dSB7Ci0JdW5zaWduZWQgc2hvcnQgdXM7Ci0JdW5zaWduZWQgY2hhciBi
WzJdOwotfTsKLQotLyogRW5kaWFuIGluZGVwZW5kZWQgdmVyc2lvbiAqLwotc3RhdGljIGlubGlu
ZSB1bnNpZ25lZCBzaG9ydAotZ2V0X3VuYWxpZ25lZDE2KGNvbnN0IHVuc2lnbmVkIHNob3J0ICpw
KQotewotCXVuaW9uIHV1ICBtbTsKLQl1bnNpZ25lZCBjaGFyICpiID0gKHVuc2lnbmVkIGNoYXIg
KilwOwotCi0JbW0uYlswXSA9IGJbMF07Ci0JbW0uYlsxXSA9IGJbMV07Ci0JcmV0dXJuIG1tLnVz
OwotfQorLyoKKyAqIEltcG9ydGVkIGZyb20gemxpYiAxLjIuMTEgd2l0aCBtaW5pbWFsIGNoYW5n
ZXM6CisgKiAgLSByZW1vdmVkIEFTTUlORgorICogIC0gcmVtb3ZlZCBaTElCX0lOVEVSTkFMCisg
KiAgLSByZW1vdmVkICJGQVIiIHBvaW50ZXIgbWFya2luZ3MKKyAqICAtIHJlbW92ZWQgVHJhY2V2
digpIHRyYWNpbmcgY2FsbHMKKyAqICAtIHR1cm5lZCAiel9jb25zdCIgaW50byBqdXN0ICJjb25z
dCIKKyAqICAtIHJlbW92ZWQgImd6X2hlYWRlcnAiIGZyb20gaW5mbGF0ZV9zdGF0ZQorICogIC0g
Y29udmVydGVkIHRvICJtb2Rlcm4iIEFOU0kgQyByYXRoZXIgdGhhbiBLJlIgc3ludGF4CisgKi8K
IAogLyoKICAgIERlY29kZSBsaXRlcmFsLCBsZW5ndGgsIGFuZCBkaXN0YW5jZSBjb2RlcyBhbmQg
d3JpdGUgb3V0IHRoZSByZXN1bHRpbmcKQEAgLTYyLDEzICs1NCwxMyBAQCBnZXRfdW5hbGlnbmVk
MTYoY29uc3QgdW5zaWduZWQgc2hvcnQgKnApCiAgICAgICByZXF1aXJlcyBzdHJtLT5hdmFpbF9v
dXQgPj0gMjU4IGZvciBlYWNoIGxvb3AgdG8gYXZvaWQgY2hlY2tpbmcgZm9yCiAgICAgICBvdXRw
dXQgc3BhY2UuCiAKLSAgICAtIEBzdGFydDoJaW5mbGF0ZSgpJ3Mgc3RhcnRpbmcgdmFsdWUgZm9y
IHN0cm0tPmF2YWlsX291dAorICAgIC0gQHN0YXJ0OiAgaW5mbGF0ZSgpJ3Mgc3RhcnRpbmcgdmFs
dWUgZm9yIHN0cm0tPmF2YWlsX291dAogICovCiB2b2lkIGluZmxhdGVfZmFzdCh6X3N0cmVhbXAg
c3RybSwgdW5zaWduZWQgc3RhcnQpCiB7CiAgICAgc3RydWN0IGluZmxhdGVfc3RhdGUgKnN0YXRl
OwogICAgIGNvbnN0IHVuc2lnbmVkIGNoYXIgKmluOyAgICAvKiBsb2NhbCBzdHJtLT5uZXh0X2lu
ICovCi0gICAgY29uc3QgdW5zaWduZWQgY2hhciAqbGFzdDsgIC8qIHdoaWxlIGluIDwgbGFzdCwg
ZW5vdWdoIGlucHV0IGF2YWlsYWJsZSAqLworICAgIGNvbnN0IHVuc2lnbmVkIGNoYXIgKmxhc3Q7
ICAvKiBoYXZlIGVub3VnaCBpbnB1dCB3aGlsZSBpbiA8IGxhc3QgKi8KICAgICB1bnNpZ25lZCBj
aGFyICpvdXQ7ICAgICAgICAgLyogbG9jYWwgc3RybS0+bmV4dF9vdXQgKi8KICAgICB1bnNpZ25l
ZCBjaGFyICpiZWc7ICAgICAgICAgLyogaW5mbGF0ZSgpJ3MgaW5pdGlhbCBzdHJtLT5uZXh0X291
dCAqLwogICAgIHVuc2lnbmVkIGNoYXIgKmVuZDsgICAgICAgICAvKiB3aGlsZSBvdXQgPCBlbmQs
IGVub3VnaCBzcGFjZSBhdmFpbGFibGUgKi8KQEAgLTc3LDcgKzY5LDcgQEAgdm9pZCBpbmZsYXRl
X2Zhc3Qoel9zdHJlYW1wIHN0cm0sIHVuc2lnbmVkIHN0YXJ0KQogI2VuZGlmCiAgICAgdW5zaWdu
ZWQgd3NpemU7ICAgICAgICAgICAgIC8qIHdpbmRvdyBzaXplIG9yIHplcm8gaWYgbm90IHVzaW5n
IHdpbmRvdyAqLwogICAgIHVuc2lnbmVkIHdoYXZlOyAgICAgICAgICAgICAvKiB2YWxpZCBieXRl
cyBpbiB0aGUgd2luZG93ICovCi0gICAgdW5zaWduZWQgd3JpdGU7ICAgICAgICAgICAgIC8qIHdp
bmRvdyB3cml0ZSBpbmRleCAqLworICAgIHVuc2lnbmVkIHduZXh0OyAgICAgICAgICAgICAvKiB3
aW5kb3cgd3JpdGUgaW5kZXggKi8KICAgICB1bnNpZ25lZCBjaGFyICp3aW5kb3c7ICAgICAgLyog
YWxsb2NhdGVkIHNsaWRpbmcgd2luZG93LCBpZiB3c2l6ZSAhPSAwICovCiAgICAgdW5zaWduZWQg
bG9uZyBob2xkOyAgICAgICAgIC8qIGxvY2FsIHN0cm0tPmhvbGQgKi8KICAgICB1bnNpZ25lZCBi
aXRzOyAgICAgICAgICAgICAgLyogbG9jYWwgc3RybS0+Yml0cyAqLwpAQCAtODUsNyArNzcsNyBA
QCB2b2lkIGluZmxhdGVfZmFzdCh6X3N0cmVhbXAgc3RybSwgdW5zaWduZWQgc3RhcnQpCiAgICAg
Y29kZSBjb25zdCAqZGNvZGU7ICAgICAgICAgIC8qIGxvY2FsIHN0cm0tPmRpc3Rjb2RlICovCiAg
ICAgdW5zaWduZWQgbG1hc2s7ICAgICAgICAgICAgIC8qIG1hc2sgZm9yIGZpcnN0IGxldmVsIG9m
IGxlbmd0aCBjb2RlcyAqLwogICAgIHVuc2lnbmVkIGRtYXNrOyAgICAgICAgICAgICAvKiBtYXNr
IGZvciBmaXJzdCBsZXZlbCBvZiBkaXN0YW5jZSBjb2RlcyAqLwotICAgIGNvZGUgdGhpczsgICAg
ICAgICAgICAgICAgICAvKiByZXRyaWV2ZWQgdGFibGUgZW50cnkgKi8KKyAgICBjb2RlIGhlcmU7
ICAgICAgICAgICAgICAgICAgLyogcmV0cmlldmVkIHRhYmxlIGVudHJ5ICovCiAgICAgdW5zaWdu
ZWQgb3A7ICAgICAgICAgICAgICAgIC8qIGNvZGUgYml0cywgb3BlcmF0aW9uLCBleHRyYSBiaXRz
LCBvciAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgd2luZG93IHBvc2l0
aW9uLCB3aW5kb3cgYnl0ZXMgdG8gY29weSAqLwogICAgIHVuc2lnbmVkIGxlbjsgICAgICAgICAg
ICAgICAvKiBtYXRjaCBsZW5ndGgsIHVudXNlZCBieXRlcyAqLwpAQCAtMTA0LDcgKzk2LDcgQEAg
dm9pZCBpbmZsYXRlX2Zhc3Qoel9zdHJlYW1wIHN0cm0sIHVuc2lnbmVkIHN0YXJ0KQogI2VuZGlm
CiAgICAgd3NpemUgPSBzdGF0ZS0+d3NpemU7CiAgICAgd2hhdmUgPSBzdGF0ZS0+d2hhdmU7Ci0g
ICAgd3JpdGUgPSBzdGF0ZS0+d3JpdGU7CisgICAgd25leHQgPSBzdGF0ZS0+d25leHQ7CiAgICAg
d2luZG93ID0gc3RhdGUtPndpbmRvdzsKICAgICBob2xkID0gc3RhdGUtPmhvbGQ7CiAgICAgYml0
cyA9IHN0YXRlLT5iaXRzOwpAQCAtMTIyLDE3ICsxMTQsMTcgQEAgdm9pZCBpbmZsYXRlX2Zhc3Qo
el9zdHJlYW1wIHN0cm0sIHVuc2lnbmVkIHN0YXJ0KQogICAgICAgICAgICAgaG9sZCArPSAodW5z
aWduZWQgbG9uZykoKmluKyspIDw8IGJpdHM7CiAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAg
ICAgIH0KLSAgICAgICAgdGhpcyA9IGxjb2RlW2hvbGQgJiBsbWFza107CisgICAgICAgIGhlcmUg
PSBsY29kZVtob2xkICYgbG1hc2tdOwogICAgICAgZG9sZW46Ci0gICAgICAgIG9wID0gKHVuc2ln
bmVkKSh0aGlzLmJpdHMpOworICAgICAgICBvcCA9ICh1bnNpZ25lZCkoaGVyZS5iaXRzKTsKICAg
ICAgICAgaG9sZCA+Pj0gb3A7CiAgICAgICAgIGJpdHMgLT0gb3A7Ci0gICAgICAgIG9wID0gKHVu
c2lnbmVkKSh0aGlzLm9wKTsKKyAgICAgICAgb3AgPSAodW5zaWduZWQpKGhlcmUub3ApOwogICAg
ICAgICBpZiAob3AgPT0gMCkgeyAgICAgICAgICAgICAgICAgICAgICAgICAgLyogbGl0ZXJhbCAq
LwotICAgICAgICAgICAgKm91dCsrID0gKHVuc2lnbmVkIGNoYXIpKHRoaXMudmFsKTsKKyAgICAg
ICAgICAgICpvdXQrKyA9ICh1bnNpZ25lZCBjaGFyKShoZXJlLnZhbCk7CiAgICAgICAgIH0KICAg
ICAgICAgZWxzZSBpZiAob3AgJiAxNikgeyAgICAgICAgICAgICAgICAgICAgIC8qIGxlbmd0aCBi
YXNlICovCi0gICAgICAgICAgICBsZW4gPSAodW5zaWduZWQpKHRoaXMudmFsKTsKKyAgICAgICAg
ICAgIGxlbiA9ICh1bnNpZ25lZCkoaGVyZS52YWwpOwogICAgICAgICAgICAgb3AgJj0gMTU7ICAg
ICAgICAgICAgICAgICAgICAgICAgICAgLyogbnVtYmVyIG9mIGV4dHJhIGJpdHMgKi8KICAgICAg
ICAgICAgIGlmIChvcCkgewogICAgICAgICAgICAgICAgIGlmIChiaXRzIDwgb3ApIHsKQEAgLTE0
OSwxNCArMTQxLDE0IEBAIHZvaWQgaW5mbGF0ZV9mYXN0KHpfc3RyZWFtcCBzdHJtLCB1bnNpZ25l
ZCBzdGFydCkKICAgICAgICAgICAgICAgICBob2xkICs9ICh1bnNpZ25lZCBsb25nKSgqaW4rKykg
PDwgYml0czsKICAgICAgICAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgICAgICB9Ci0gICAg
ICAgICAgICB0aGlzID0gZGNvZGVbaG9sZCAmIGRtYXNrXTsKKyAgICAgICAgICAgIGhlcmUgPSBk
Y29kZVtob2xkICYgZG1hc2tdOwogICAgICAgICAgIGRvZGlzdDoKLSAgICAgICAgICAgIG9wID0g
KHVuc2lnbmVkKSh0aGlzLmJpdHMpOworICAgICAgICAgICAgb3AgPSAodW5zaWduZWQpKGhlcmUu
Yml0cyk7CiAgICAgICAgICAgICBob2xkID4+PSBvcDsKICAgICAgICAgICAgIGJpdHMgLT0gb3A7
Ci0gICAgICAgICAgICBvcCA9ICh1bnNpZ25lZCkodGhpcy5vcCk7CisgICAgICAgICAgICBvcCA9
ICh1bnNpZ25lZCkoaGVyZS5vcCk7CiAgICAgICAgICAgICBpZiAob3AgJiAxNikgeyAgICAgICAg
ICAgICAgICAgICAgICAvKiBkaXN0YW5jZSBiYXNlICovCi0gICAgICAgICAgICAgICAgZGlzdCA9
ICh1bnNpZ25lZCkodGhpcy52YWwpOworICAgICAgICAgICAgICAgIGRpc3QgPSAodW5zaWduZWQp
KGhlcmUudmFsKTsKICAgICAgICAgICAgICAgICBvcCAmPSAxNTsgICAgICAgICAgICAgICAgICAg
ICAgIC8qIG51bWJlciBvZiBleHRyYSBiaXRzICovCiAgICAgICAgICAgICAgICAgaWYgKGJpdHMg
PCBvcCkgewogICAgICAgICAgICAgICAgICAgICBob2xkICs9ICh1bnNpZ25lZCBsb25nKSgqaW4r
KykgPDwgYml0czsKQEAgLTE4MCwxMiArMTcyLDM0IEBAIHZvaWQgaW5mbGF0ZV9mYXN0KHpfc3Ry
ZWFtcCBzdHJtLCB1bnNpZ25lZCBzdGFydCkKICAgICAgICAgICAgICAgICBpZiAoZGlzdCA+IG9w
KSB7ICAgICAgICAgICAgICAgIC8qIHNlZSBpZiBjb3B5IGZyb20gd2luZG93ICovCiAgICAgICAg
ICAgICAgICAgICAgIG9wID0gZGlzdCAtIG9wOyAgICAgICAgICAgICAvKiBkaXN0YW5jZSBiYWNr
IGluIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICAgICBpZiAob3AgPiB3aGF2ZSkgewotICAg
ICAgICAgICAgICAgICAgICAgICAgc3RybS0+bXNnID0gKGNoYXIgKikiaW52YWxpZCBkaXN0YW5j
ZSB0b28gZmFyIGJhY2siOwotICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUtPm1vZGUgPSBC
QUQ7Ci0gICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKKyAgICAgICAgICAgICAgICAgICAg
ICAgIGlmIChzdGF0ZS0+c2FuZSkgeworICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0cm0t
Pm1zZyA9CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjaGFyICopImludmFsaWQg
ZGlzdGFuY2UgdG9vIGZhciBiYWNrIjsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0
ZS0+bW9kZSA9IEJBRDsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKKyAgICAg
ICAgICAgICAgICAgICAgICAgIH0KKyNpZmRlZiBJTkZMQVRFX0FMTE9XX0lOVkFMSURfRElTVEFO
Q0VfVE9PRkFSX0FSUlIKKyAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW4gPD0gb3AgLSB3
aGF2ZSkgeworICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKKyAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgKm91dCsrID0gMDsKKyAgICAgICAgICAgICAgICAgICAgICAgICAg
ICB9IHdoaWxlICgtLWxlbik7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7
CisgICAgICAgICAgICAgICAgICAgICAgICB9CisgICAgICAgICAgICAgICAgICAgICAgICBsZW4g
LT0gb3AgLSB3aGF2ZTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAqb3V0KysgPSAwOworICAgICAgICAgICAgICAgICAgICAgICAgfSB3
aGlsZSAoLS1vcCA+IHdoYXZlKTsKKyAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcCA9PSAw
KSB7CisgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9IG91dCAtIGRpc3Q7CisgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZG8geworICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAqb3V0KysgPSAqZnJvbSsrOworICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hp
bGUgKC0tbGVuKTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKKyAgICAg
ICAgICAgICAgICAgICAgICAgIH0KKyNlbmRpZgogICAgICAgICAgICAgICAgICAgICB9CiAgICAg
ICAgICAgICAgICAgICAgIGZyb20gPSB3aW5kb3c7Ci0gICAgICAgICAgICAgICAgICAgIGlmICh3
cml0ZSA9PSAwKSB7ICAgICAgICAgICAvKiB2ZXJ5IGNvbW1vbiBjYXNlICovCisgICAgICAgICAg
ICAgICAgICAgIGlmICh3bmV4dCA9PSAwKSB7ICAgICAgICAgICAvKiB2ZXJ5IGNvbW1vbiBjYXNl
ICovCiAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tICs9IHdzaXplIC0gb3A7CiAgICAgICAg
ICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4pIHsgICAgICAgICAvKiBzb21lIGZyb20gd2lu
ZG93ICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVuIC09IG9wOwpAQCAtMTk1LDE3
ICsyMDksMTcgQEAgdm9pZCBpbmZsYXRlX2Zhc3Qoel9zdHJlYW1wIHN0cm0sIHVuc2lnbmVkIHN0
YXJ0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBvdXQgLSBkaXN0OyAgLyog
cmVzdCBmcm9tIG91dHB1dCAqLwogICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg
ICAgICAgICAgICB9Ci0gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHdyaXRlIDwgb3ApIHsg
ICAgICAvKiB3cmFwIGFyb3VuZCB3aW5kb3cgKi8KLSAgICAgICAgICAgICAgICAgICAgICAgIGZy
b20gKz0gd3NpemUgKyB3cml0ZSAtIG9wOwotICAgICAgICAgICAgICAgICAgICAgICAgb3AgLT0g
d3JpdGU7CisgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHduZXh0IDwgb3ApIHsgICAgICAv
KiB3cmFwIGFyb3VuZCB3aW5kb3cgKi8KKyAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gKz0g
d3NpemUgKyB3bmV4dCAtIG9wOworICAgICAgICAgICAgICAgICAgICAgICAgb3AgLT0gd25leHQ7
CiAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3AgPCBsZW4pIHsgICAgICAgICAvKiBzb21l
IGZyb20gZW5kIG9mIHdpbmRvdyAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAt
PSBvcDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICpvdXQrKyA9ICpmcm9tKys7CiAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgfSB3aGlsZSAoLS1vcCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSA9
IHdpbmRvdzsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod3JpdGUgPCBsZW4pIHsg
IC8qIHNvbWUgZnJvbSBzdGFydCBvZiB3aW5kb3cgKi8KLSAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgb3AgPSB3cml0ZTsKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod25l
eHQgPCBsZW4pIHsgIC8qIHNvbWUgZnJvbSBzdGFydCBvZiB3aW5kb3cgKi8KKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgb3AgPSB3bmV4dDsKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgbGVuIC09IG9wOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7
CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqb3V0KysgPSAqZnJvbSsrOwpA
QCAtMjE1LDcgKzIyOSw3IEBAIHZvaWQgaW5mbGF0ZV9mYXN0KHpfc3RyZWFtcCBzdHJtLCB1bnNp
Z25lZCBzdGFydCkKICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg
ICAgfQogICAgICAgICAgICAgICAgICAgICBlbHNlIHsgICAgICAgICAgICAgICAgICAgICAgLyog
Y29udGlndW91cyBpbiB3aW5kb3cgKi8KLSAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gKz0g
d3JpdGUgLSBvcDsKKyAgICAgICAgICAgICAgICAgICAgICAgIGZyb20gKz0gd25leHQgLSBvcDsK
ICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcCA8IGxlbikgeyAgICAgICAgIC8qIHNvbWUg
ZnJvbSB3aW5kb3cgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW4gLT0gb3A7CiAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgZG8gewpAQCAtMjM3LDU0ICsyNTEsMjIgQEAgdm9p
ZCBpbmZsYXRlX2Zhc3Qoel9zdHJlYW1wIHN0cm0sIHVuc2lnbmVkIHN0YXJ0KQogICAgICAgICAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgIGVsc2Ugewot
CQkgICAgdW5zaWduZWQgc2hvcnQgKnNvdXQ7Ci0JCSAgICB1bnNpZ25lZCBsb25nIGxvb3BzOwot
CiAgICAgICAgICAgICAgICAgICAgIGZyb20gPSBvdXQgLSBkaXN0OyAgICAgICAgICAvKiBjb3B5
IGRpcmVjdCBmcm9tIG91dHB1dCAqLwotCQkgICAgLyogbWluaW11bSBsZW5ndGggaXMgdGhyZWUg
Ki8KLQkJICAgIC8qIEFsaWduIG91dCBhZGRyICovCi0JCSAgICBpZiAoISgobG9uZykob3V0IC0g
MSkgJiAxKSkgewotCQkJKm91dCsrID0gKmZyb20rKzsKLQkJCWxlbi0tOwotCQkgICAgfQotCQkg
ICAgc291dCA9ICh1bnNpZ25lZCBzaG9ydCAqKShvdXQpOwotCQkgICAgaWYgKGRpc3QgPiAyKSB7
Ci0JCQl1bnNpZ25lZCBzaG9ydCAqc2Zyb207Ci0KLQkJCXNmcm9tID0gKHVuc2lnbmVkIHNob3J0
ICopKGZyb20pOwotCQkJbG9vcHMgPSBsZW4gPj4gMTsKLQkJCWRvCi0jaWZkZWYgQ09ORklHX0hB
VkVfRUZGSUNJRU5UX1VOQUxJR05FRF9BQ0NFU1MKLQkJCSAgICAqc291dCsrID0gKnNmcm9tKys7
Ci0jZWxzZQotCQkJICAgICpzb3V0KysgPSBnZXRfdW5hbGlnbmVkMTYoc2Zyb20rKyk7Ci0jZW5k
aWYKLQkJCXdoaWxlICgtLWxvb3BzKTsKLQkJCW91dCA9ICh1bnNpZ25lZCBjaGFyICopc291dDsK
LQkJCWZyb20gPSAodW5zaWduZWQgY2hhciAqKXNmcm9tOwotCQkgICAgfSBlbHNlIHsgLyogZGlz
dCA9PSAxIG9yIGRpc3QgPT0gMiAqLwotCQkJdW5zaWduZWQgc2hvcnQgcGF0MTY7Ci0KLQkJCXBh
dDE2ID0gKihzb3V0LTEpOwotCQkJaWYgKGRpc3QgPT0gMSkgewotCQkJCXVuaW9uIHV1IG1tOwot
CQkJCS8qIGNvcHkgb25lIGNoYXIgcGF0dGVybiB0byBib3RoIGJ5dGVzICovCi0JCQkJbW0udXMg
PSBwYXQxNjsKLQkJCQltbS5iWzBdID0gbW0uYlsxXTsKLQkJCQlwYXQxNiA9IG1tLnVzOwotCQkJ
fQotCQkJbG9vcHMgPSBsZW4gPj4gMTsKLQkJCWRvCi0JCQkgICAgKnNvdXQrKyA9IHBhdDE2Owot
CQkJd2hpbGUgKC0tbG9vcHMpOwotCQkJb3V0ID0gKHVuc2lnbmVkIGNoYXIgKilzb3V0OwotCQkg
ICAgfQotCQkgICAgaWYgKGxlbiAmIDEpCi0JCQkqb3V0KysgPSAqZnJvbSsrOworICAgICAgICAg
ICAgICAgICAgICBkbyB7ICAgICAgICAgICAgICAgICAgICAgICAgLyogbWluaW11bSBsZW5ndGgg
aXMgdGhyZWUgKi8KKyAgICAgICAgICAgICAgICAgICAgICAgICpvdXQrKyA9ICpmcm9tKys7Cisg
ICAgICAgICAgICAgICAgICAgICAgICAqb3V0KysgPSAqZnJvbSsrOworICAgICAgICAgICAgICAg
ICAgICAgICAgKm91dCsrID0gKmZyb20rKzsKKyAgICAgICAgICAgICAgICAgICAgICAgIGxlbiAt
PSAzOworICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChsZW4gPiAyKTsKKyAgICAgICAgICAg
ICAgICAgICAgaWYgKGxlbikgeworICAgICAgICAgICAgICAgICAgICAgICAgKm91dCsrID0gKmZy
b20rKzsKKyAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW4gPiAxKQorICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICpvdXQrKyA9ICpmcm9tKys7CisgICAgICAgICAgICAgICAgICAgIH0K
ICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICB9CiAgICAgICAgICAgICBlbHNlIGlmICgo
b3AgJiA2NCkgPT0gMCkgeyAgICAgICAgICAvKiAybmQgbGV2ZWwgZGlzdGFuY2UgY29kZSAqLwot
ICAgICAgICAgICAgICAgIHRoaXMgPSBkY29kZVt0aGlzLnZhbCArIChob2xkICYgKCgxVSA8PCBv
cCkgLSAxKSldOworICAgICAgICAgICAgICAgIGhlcmUgPSBkY29kZVtoZXJlLnZhbCArIChob2xk
ICYgKCgxVSA8PCBvcCkgLSAxKSldOwogICAgICAgICAgICAgICAgIGdvdG8gZG9kaXN0OwogICAg
ICAgICAgICAgfQogICAgICAgICAgICAgZWxzZSB7CkBAIC0yOTQsNyArMjc2LDcgQEAgdm9pZCBp
bmZsYXRlX2Zhc3Qoel9zdHJlYW1wIHN0cm0sIHVuc2lnbmVkIHN0YXJ0KQogICAgICAgICAgICAg
fQogICAgICAgICB9CiAgICAgICAgIGVsc2UgaWYgKChvcCAmIDY0KSA9PSAwKSB7ICAgICAgICAg
ICAgICAvKiAybmQgbGV2ZWwgbGVuZ3RoIGNvZGUgKi8KLSAgICAgICAgICAgIHRoaXMgPSBsY29k
ZVt0aGlzLnZhbCArIChob2xkICYgKCgxVSA8PCBvcCkgLSAxKSldOworICAgICAgICAgICAgaGVy
ZSA9IGxjb2RlW2hlcmUudmFsICsgKGhvbGQgJiAoKDFVIDw8IG9wKSAtIDEpKV07CiAgICAgICAg
ICAgICBnb3RvIGRvbGVuOwogICAgICAgICB9CiAgICAgICAgIGVsc2UgaWYgKG9wICYgMzIpIHsg
ICAgICAgICAgICAgICAgICAgICAvKiBlbmQtb2YtYmxvY2sgKi8KQEAgLTMyOSw3ICszMTEsNyBA
QCB2b2lkIGluZmxhdGVfZmFzdCh6X3N0cmVhbXAgc3RybSwgdW5zaWduZWQgc3RhcnQpCiAgICBp
bmZsYXRlX2Zhc3QoKSBzcGVlZHVwcyB0aGF0IHR1cm5lZCBvdXQgc2xvd2VyIChvbiBhIFBvd2Vy
UEMgRzMgNzUwQ1hlKToKICAgIC0gVXNpbmcgYml0IGZpZWxkcyBmb3IgY29kZSBzdHJ1Y3R1cmUK
ICAgIC0gRGlmZmVyZW50IG9wIGRlZmluaXRpb24gdG8gYXZvaWQgJiBmb3IgZXh0cmEgYml0cyAo
ZG8gJiBmb3IgdGFibGUgYml0cykKLSAgIC0gVGhyZWUgc2VwYXJhdGUgZGVjb2RpbmcgZG8tbG9v
cHMgZm9yIGRpcmVjdCwgd2luZG93LCBhbmQgd3JpdGUgPT0gMAorICAgLSBUaHJlZSBzZXBhcmF0
ZSBkZWNvZGluZyBkby1sb29wcyBmb3IgZGlyZWN0LCB3aW5kb3csIGFuZCB3bmV4dCA9PSAwCiAg
ICAtIFNwZWNpYWwgY2FzZSBmb3IgZGlzdGFuY2UgPiAxIGNvcGllcyB0byBkbyBvdmVybGFwcGVk
IGxvYWQgYW5kIHN0b3JlIGNvcHkKICAgIC0gRXhwbGljaXQgYnJhbmNoIHByZWRpY3Rpb25zIChi
YXNlZCBvbiBtZWFzdXJlZCBicmFuY2ggcHJvYmFiaWxpdGllcykKICAgIC0gRGVmZXJyaW5nIG1h
dGNoIGNvcHkgYW5kIGludGVyc3BlcnNlZCBpdCB3aXRoIGRlY29kaW5nIHN1YnNlcXVlbnQgY29k
ZXMKQEAgLTMzOCw1ICszMjAsMyBAQCB2b2lkIGluZmxhdGVfZmFzdCh6X3N0cmVhbXAgc3RybSwg
dW5zaWduZWQgc3RhcnQpCiAgICAtIExhcmdlciB1bnJvbGxlZCBjb3B5IGxvb3BzICh0aHJlZSBp
cyBhYm91dCByaWdodCkKICAgIC0gTW92aW5nIGxlbiAtPSAzIHN0YXRlbWVudCBpbnRvIG1pZGRs
ZSBvZiBsb29wCiAgKi8KLQotI2VuZGlmIC8qICFBU01JTkYgKi8KZGlmZiAtLWdpdCBhL2xpYi96
bGliX2luZmxhdGUvaW5mbGF0ZS5jIGIvbGliL3psaWJfaW5mbGF0ZS9pbmZsYXRlLmMKaW5kZXgg
ZWUzOWI1ZWI3MWY3Li5jNmQxOTg5NjBlMGYgMTAwNjQ0Ci0tLSBhL2xpYi96bGliX2luZmxhdGUv
aW5mbGF0ZS5jCisrKyBiL2xpYi96bGliX2luZmxhdGUvaW5mbGF0ZS5jCkBAIC0yNSw2ICsyNSwx
MSBAQAogI2RlZmluZSBJTkZMQVRFX05FRURfQ0hFQ0tTVU0oc3RybSkgMQogI2VuZGlmCiAKKy8q
IFJldmVyc2UgdGhlIGJ5dGVzIGluIGEgMzItYml0IHZhbHVlICovCisjZGVmaW5lIFJFVkVSU0Uo
cSkgXAorICAgICgoKChxKSA+PiAyNCkgJiAweGZmKSArICgoKHEpID4+IDgpICYgMHhmZjAwKSAr
IFwKKyAgICAgKCgocSkgJiAweGZmMDApIDw8IDgpICsgKCgocSkgJiAweGZmKSA8PCAyNCkpCisK
IGludCB6bGliX2luZmxhdGVfd29ya3NwYWNlc2l6ZSh2b2lkKQogewogICAgIHJldHVybiBzaXpl
b2Yoc3RydWN0IGluZmxhdGVfd29ya3NwYWNlKTsKQEAgLTQ5LDcgKzU0LDcgQEAgaW50IHpsaWJf
aW5mbGF0ZVJlc2V0KHpfc3RyZWFtcCBzdHJtKQogCiAgICAgLyogSW5pdGlhbGlzZSBXaW5kb3cg
Ki8KICAgICBzdGF0ZS0+d3NpemUgPSAxVSA8PCBzdGF0ZS0+d2JpdHM7Ci0gICAgc3RhdGUtPndy
aXRlID0gMDsKKyAgICBzdGF0ZS0+d25leHQgPSAwOwogICAgIHN0YXRlLT53aGF2ZSA9IDA7CiAK
ICAgICBJTkZMQVRFX1JFU0VUX0hPT0soc3RybSk7CkBAIC0xMjgsMjIgKzEzMywyMiBAQCBzdGF0
aWMgdm9pZCB6bGliX3VwZGF0ZXdpbmRvdyh6X3N0cmVhbXAgc3RybSwgdW5zaWduZWQgb3V0KQog
ICAgIGNvcHkgPSBvdXQgLSBzdHJtLT5hdmFpbF9vdXQ7CiAgICAgaWYgKGNvcHkgPj0gc3RhdGUt
PndzaXplKSB7CiAgICAgICAgIG1lbWNweShzdGF0ZS0+d2luZG93LCBzdHJtLT5uZXh0X291dCAt
IHN0YXRlLT53c2l6ZSwgc3RhdGUtPndzaXplKTsKLSAgICAgICAgc3RhdGUtPndyaXRlID0gMDsK
KyAgICAgICAgc3RhdGUtPnduZXh0ID0gMDsKICAgICAgICAgc3RhdGUtPndoYXZlID0gc3RhdGUt
PndzaXplOwogICAgIH0KICAgICBlbHNlIHsKLSAgICAgICAgZGlzdCA9IHN0YXRlLT53c2l6ZSAt
IHN0YXRlLT53cml0ZTsKKyAgICAgICAgZGlzdCA9IHN0YXRlLT53c2l6ZSAtIHN0YXRlLT53bmV4
dDsKICAgICAgICAgaWYgKGRpc3QgPiBjb3B5KSBkaXN0ID0gY29weTsKLSAgICAgICAgbWVtY3B5
KHN0YXRlLT53aW5kb3cgKyBzdGF0ZS0+d3JpdGUsIHN0cm0tPm5leHRfb3V0IC0gY29weSwgZGlz
dCk7CisgICAgICAgIG1lbWNweShzdGF0ZS0+d2luZG93ICsgc3RhdGUtPnduZXh0LCBzdHJtLT5u
ZXh0X291dCAtIGNvcHksIGRpc3QpOwogICAgICAgICBjb3B5IC09IGRpc3Q7CiAgICAgICAgIGlm
IChjb3B5KSB7CiAgICAgICAgICAgICBtZW1jcHkoc3RhdGUtPndpbmRvdywgc3RybS0+bmV4dF9v
dXQgLSBjb3B5LCBjb3B5KTsKLSAgICAgICAgICAgIHN0YXRlLT53cml0ZSA9IGNvcHk7CisgICAg
ICAgICAgICBzdGF0ZS0+d25leHQgPSBjb3B5OwogICAgICAgICAgICAgc3RhdGUtPndoYXZlID0g
c3RhdGUtPndzaXplOwogICAgICAgICB9CiAgICAgICAgIGVsc2UgewotICAgICAgICAgICAgc3Rh
dGUtPndyaXRlICs9IGRpc3Q7Ci0gICAgICAgICAgICBpZiAoc3RhdGUtPndyaXRlID09IHN0YXRl
LT53c2l6ZSkgc3RhdGUtPndyaXRlID0gMDsKKyAgICAgICAgICAgIHN0YXRlLT53bmV4dCArPSBk
aXN0OworICAgICAgICAgICAgaWYgKHN0YXRlLT53bmV4dCA9PSBzdGF0ZS0+d3NpemUpIHN0YXRl
LT53bmV4dCA9IDA7CiAgICAgICAgICAgICBpZiAoc3RhdGUtPndoYXZlIDwgc3RhdGUtPndzaXpl
KSBzdGF0ZS0+d2hhdmUgKz0gZGlzdDsKICAgICAgICAgfQogICAgIH0KQEAgLTY3NSwxMiArNjgw
LDEyIEBAIGludCB6bGliX2luZmxhdGUoel9zdHJlYW1wIHN0cm0sIGludCBmbHVzaCkKICAgICAg
ICAgICAgIGNvcHkgPSBvdXQgLSBsZWZ0OwogICAgICAgICAgICAgaWYgKHN0YXRlLT5vZmZzZXQg
PiBjb3B5KSB7ICAgICAgICAgLyogY29weSBmcm9tIHdpbmRvdyAqLwogICAgICAgICAgICAgICAg
IGNvcHkgPSBzdGF0ZS0+b2Zmc2V0IC0gY29weTsKLSAgICAgICAgICAgICAgICBpZiAoY29weSA+
IHN0YXRlLT53cml0ZSkgewotICAgICAgICAgICAgICAgICAgICBjb3B5IC09IHN0YXRlLT53cml0
ZTsKKyAgICAgICAgICAgICAgICBpZiAoY29weSA+IHN0YXRlLT53bmV4dCkgeworICAgICAgICAg
ICAgICAgICAgICBjb3B5IC09IHN0YXRlLT53bmV4dDsKICAgICAgICAgICAgICAgICAgICAgZnJv
bSA9IHN0YXRlLT53aW5kb3cgKyAoc3RhdGUtPndzaXplIC0gY29weSk7CiAgICAgICAgICAgICAg
ICAgfQogICAgICAgICAgICAgICAgIGVsc2UKLSAgICAgICAgICAgICAgICAgICAgZnJvbSA9IHN0
YXRlLT53aW5kb3cgKyAoc3RhdGUtPndyaXRlIC0gY29weSk7CisgICAgICAgICAgICAgICAgICAg
IGZyb20gPSBzdGF0ZS0+d2luZG93ICsgKHN0YXRlLT53bmV4dCAtIGNvcHkpOwogICAgICAgICAg
ICAgICAgIGlmIChjb3B5ID4gc3RhdGUtPmxlbmd0aCkgY29weSA9IHN0YXRlLT5sZW5ndGg7CiAg
ICAgICAgICAgICB9CiAgICAgICAgICAgICBlbHNlIHsgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAvKiBjb3B5IGZyb20gb3V0cHV0ICovCmRpZmYgLS1naXQgYS9saWIvemxpYl9pbmZsYXRl
L2luZmxhdGUuaCBiL2xpYi96bGliX2luZmxhdGUvaW5mbGF0ZS5oCmluZGV4IGY3OTMzN2RkZjk4
Yy4uNmVjZThlZmQ4NzliIDEwMDY0NAotLS0gYS9saWIvemxpYl9pbmZsYXRlL2luZmxhdGUuaAor
KysgYi9saWIvemxpYl9pbmZsYXRlL2luZmxhdGUuaApAQCAtMSw4ICsxLDUgQEAKLSNpZm5kZWYg
SU5GTEFURV9ICi0jZGVmaW5lIElORkxBVEVfSAotCiAvKiBpbmZsYXRlLmggLS0gaW50ZXJuYWwg
aW5mbGF0ZSBzdGF0ZSBkZWZpbml0aW9uCi0gKiBDb3B5cmlnaHQgKEMpIDE5OTUtMjAwNCBNYXJr
IEFkbGVyCisgKiBDb3B5cmlnaHQgKEMpIDE5OTUtMjAxNiBNYXJrIEFkbGVyCiAgKiBGb3IgY29u
ZGl0aW9ucyBvZiBkaXN0cmlidXRpb24gYW5kIHVzZSwgc2VlIGNvcHlyaWdodCBub3RpY2UgaW4g
emxpYi5oCiAgKi8KIApAQCAtMTEsMTEgKzgsMTcgQEAKICAgIHN1YmplY3QgdG8gY2hhbmdlLiBB
cHBsaWNhdGlvbnMgc2hvdWxkIG9ubHkgdXNlIHpsaWIuaC4KICAqLwogCi0jaW5jbHVkZSAiaW5m
dHJlZXMuaCIKKy8qIGRlZmluZSBOT19HWklQIHdoZW4gY29tcGlsaW5nIGlmIHlvdSB3YW50IHRv
IGRpc2FibGUgZ3ppcCBoZWFkZXIgYW5kCisgICB0cmFpbGVyIGRlY29kaW5nIGJ5IGluZmxhdGUo
KS4gIE5PX0daSVAgd291bGQgYmUgdXNlZCB0byBhdm9pZCBsaW5raW5nIGluCisgICB0aGUgY3Jj
IGNvZGUgd2hlbiBpdCBpcyBub3QgbmVlZGVkLiAgRm9yIHNoYXJlZCBsaWJyYXJpZXMsIGd6aXAg
ZGVjb2RpbmcKKyAgIHNob3VsZCBiZSBsZWZ0IGVuYWJsZWQuICovCisjaWZuZGVmIE5PX0daSVAK
KyMgIGRlZmluZSBHVU5aSVAKKyNlbmRpZgogCiAvKiBQb3NzaWJsZSBpbmZsYXRlIG1vZGVzIGJl
dHdlZW4gaW5mbGF0ZSgpIGNhbGxzICovCiB0eXBlZGVmIGVudW0gewotICAgIEhFQUQsICAgICAg
IC8qIGk6IHdhaXRpbmcgZm9yIG1hZ2ljIGhlYWRlciAqLworICAgIEhFQUQgPSAxNjE4MCwgICAv
KiBpOiB3YWl0aW5nIGZvciBtYWdpYyBoZWFkZXIgKi8KICAgICBGTEFHUywgICAgICAvKiBpOiB3
YWl0aW5nIGZvciBtZXRob2QgYW5kIGZsYWdzIChnemlwKSAqLwogICAgIFRJTUUsICAgICAgIC8q
IGk6IHdhaXRpbmcgZm9yIG1vZGlmaWNhdGlvbiB0aW1lIChnemlwKSAqLwogICAgIE9TLCAgICAg
ICAgIC8qIGk6IHdhaXRpbmcgZm9yIGV4dHJhIGZsYWdzIGFuZCBvcGVyYXRpbmcgc3lzdGVtIChn
emlwKSAqLwpAQCAtMjksMTEgKzMyLDEzIEBAIHR5cGVkZWYgZW51bSB7CiAgICAgICAgIFRZUEUs
ICAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIHR5cGUgYml0cywgaW5jbHVkaW5nIGxhc3QtZmxhZyBi
aXQgKi8KICAgICAgICAgVFlQRURPLCAgICAgLyogaTogc2FtZSwgYnV0IHNraXAgY2hlY2sgdG8g
ZXhpdCBpbmZsYXRlIG9uIG5ldyBibG9jayAqLwogICAgICAgICBTVE9SRUQsICAgICAvKiBpOiB3
YWl0aW5nIGZvciBzdG9yZWQgc2l6ZSAobGVuZ3RoIGFuZCBjb21wbGVtZW50KSAqLworICAgICAg
ICBDT1BZXywgICAgICAvKiBpL286IHNhbWUgYXMgQ09QWSBiZWxvdywgYnV0IG9ubHkgZmlyc3Qg
dGltZSBpbiAqLwogICAgICAgICBDT1BZLCAgICAgICAvKiBpL286IHdhaXRpbmcgZm9yIGlucHV0
IG9yIG91dHB1dCB0byBjb3B5IHN0b3JlZCBibG9jayAqLwogICAgICAgICBUQUJMRSwgICAgICAv
KiBpOiB3YWl0aW5nIGZvciBkeW5hbWljIGJsb2NrIHRhYmxlIGxlbmd0aHMgKi8KICAgICAgICAg
TEVOTEVOUywgICAgLyogaTogd2FpdGluZyBmb3IgY29kZSBsZW5ndGggY29kZSBsZW5ndGhzICov
CiAgICAgICAgIENPREVMRU5TLCAgIC8qIGk6IHdhaXRpbmcgZm9yIGxlbmd0aC9saXQgYW5kIGRp
c3RhbmNlIGNvZGUgbGVuZ3RocyAqLwotICAgICAgICAgICAgTEVOLCAgICAgICAgLyogaTogd2Fp
dGluZyBmb3IgbGVuZ3RoL2xpdCBjb2RlICovCisgICAgICAgICAgICBMRU5fLCAgICAgICAvKiBp
OiBzYW1lIGFzIExFTiBiZWxvdywgYnV0IG9ubHkgZmlyc3QgdGltZSBpbiAqLworICAgICAgICAg
ICAgTEVOLCAgICAgICAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoL2xpdC9lb2IgY29kZSAqLwog
ICAgICAgICAgICAgTEVORVhULCAgICAgLyogaTogd2FpdGluZyBmb3IgbGVuZ3RoIGV4dHJhIGJp
dHMgKi8KICAgICAgICAgICAgIERJU1QsICAgICAgIC8qIGk6IHdhaXRpbmcgZm9yIGRpc3RhbmNl
IGNvZGUgKi8KICAgICAgICAgICAgIERJU1RFWFQsICAgIC8qIGk6IHdhaXRpbmcgZm9yIGRpc3Rh
bmNlIGV4dHJhIGJpdHMgKi8KQEAgLTUwLDE5ICs1NSwyMSBAQCB0eXBlZGVmIGVudW0gewogLyoK
ICAgICBTdGF0ZSB0cmFuc2l0aW9ucyBiZXR3ZWVuIGFib3ZlIG1vZGVzIC0KIAotICAgIChtb3N0
IG1vZGVzIGNhbiBnbyB0byB0aGUgQkFEIG9yIE1FTSBtb2RlIC0tIG5vdCBzaG93biBmb3IgY2xh
cml0eSkKKyAgICAobW9zdCBtb2RlcyBjYW4gZ28gdG8gQkFEIG9yIE1FTSBvbiBlcnJvciAtLSBu
b3Qgc2hvd24gZm9yIGNsYXJpdHkpCiAKICAgICBQcm9jZXNzIGhlYWRlcjoKLSAgICAgICAgSEVB
RCAtPiAoZ3ppcCkgb3IgKHpsaWIpCi0gICAgICAgIChnemlwKSAtPiBGTEFHUyAtPiBUSU1FIC0+
IE9TIC0+IEVYTEVOIC0+IEVYVFJBIC0+IE5BTUUKLSAgICAgICAgTkFNRSAtPiBDT01NRU5UIC0+
IEhDUkMgLT4gVFlQRQorICAgICAgICBIRUFEIC0+IChnemlwKSBvciAoemxpYikgb3IgKHJhdykK
KyAgICAgICAgKGd6aXApIC0+IEZMQUdTIC0+IFRJTUUgLT4gT1MgLT4gRVhMRU4gLT4gRVhUUkEg
LT4gTkFNRSAtPiBDT01NRU5UIC0+CisgICAgICAgICAgICAgICAgICBIQ1JDIC0+IFRZUEUKICAg
ICAgICAgKHpsaWIpIC0+IERJQ1RJRCBvciBUWVBFCiAgICAgICAgIERJQ1RJRCAtPiBESUNUIC0+
IFRZUEUKKyAgICAgICAgKHJhdykgLT4gVFlQRURPCiAgICAgUmVhZCBkZWZsYXRlIGJsb2NrczoK
LSAgICAgICAgICAgIFRZUEUgLT4gU1RPUkVEIG9yIFRBQkxFIG9yIExFTiBvciBDSEVDSwotICAg
ICAgICAgICAgU1RPUkVEIC0+IENPUFkgLT4gVFlQRQotICAgICAgICAgICAgVEFCTEUgLT4gTEVO
TEVOUyAtPiBDT0RFTEVOUyAtPiBMRU4KLSAgICBSZWFkIGRlZmxhdGUgY29kZXM6CisgICAgICAg
ICAgICBUWVBFIC0+IFRZUEVETyAtPiBTVE9SRUQgb3IgVEFCTEUgb3IgTEVOXyBvciBDSEVDSwor
ICAgICAgICAgICAgU1RPUkVEIC0+IENPUFlfIC0+IENPUFkgLT4gVFlQRQorICAgICAgICAgICAg
VEFCTEUgLT4gTEVOTEVOUyAtPiBDT0RFTEVOUyAtPiBMRU5fCisgICAgICAgICAgICBMRU5fIC0+
IExFTgorICAgIFJlYWQgZGVmbGF0ZSBjb2RlcyBpbiBmaXhlZCBvciBkeW5hbWljIGJsb2NrOgog
ICAgICAgICAgICAgICAgIExFTiAtPiBMRU5FWFQgb3IgTElUIG9yIFRZUEUKICAgICAgICAgICAg
ICAgICBMRU5FWFQgLT4gRElTVCAtPiBESVNURVhUIC0+IE1BVENIIC0+IExFTgogICAgICAgICAg
ICAgICAgIExJVCAtPiBMRU4KQEAgLTcwLDIzICs3NywyNiBAQCB0eXBlZGVmIGVudW0gewogICAg
ICAgICBDSEVDSyAtPiBMRU5HVEggLT4gRE9ORQogICovCiAKLS8qIHN0YXRlIG1haW50YWluZWQg
YmV0d2VlbiBpbmZsYXRlKCkgY2FsbHMuICBBcHByb3hpbWF0ZWx5IDdLIGJ5dGVzLiAqLworLyog
U3RhdGUgbWFpbnRhaW5lZCBiZXR3ZWVuIGluZmxhdGUoKSBjYWxscyAtLSBhcHByb3hpbWF0ZWx5
IDdLIGJ5dGVzLCBub3QKKyAgIGluY2x1ZGluZyB0aGUgYWxsb2NhdGVkIHNsaWRpbmcgd2luZG93
LCB3aGljaCBpcyB1cCB0byAzMksgYnl0ZXMuICovCiBzdHJ1Y3QgaW5mbGF0ZV9zdGF0ZSB7Cisg
ICAgel9zdHJlYW1wIHN0cm07ICAgICAgICAgICAgIC8qIHBvaW50ZXIgYmFjayB0byB0aGlzIHps
aWIgc3RyZWFtICovCiAgICAgaW5mbGF0ZV9tb2RlIG1vZGU7ICAgICAgICAgIC8qIGN1cnJlbnQg
aW5mbGF0ZSBtb2RlICovCiAgICAgaW50IGxhc3Q7ICAgICAgICAgICAgICAgICAgIC8qIHRydWUg
aWYgcHJvY2Vzc2luZyBsYXN0IGJsb2NrICovCi0gICAgaW50IHdyYXA7ICAgICAgICAgICAgICAg
ICAgIC8qIGJpdCAwIHRydWUgZm9yIHpsaWIsIGJpdCAxIHRydWUgZm9yIGd6aXAgKi8KKyAgICBp
bnQgd3JhcDsgICAgICAgICAgICAgICAgICAgLyogYml0IDAgdHJ1ZSBmb3IgemxpYiwgYml0IDEg
dHJ1ZSBmb3IgZ3ppcCwKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYml0IDIg
dHJ1ZSB0byB2YWxpZGF0ZSBjaGVjayB2YWx1ZSAqLwogICAgIGludCBoYXZlZGljdDsgICAgICAg
ICAgICAgICAvKiB0cnVlIGlmIGRpY3Rpb25hcnkgcHJvdmlkZWQgKi8KICAgICBpbnQgZmxhZ3M7
ICAgICAgICAgICAgICAgICAgLyogZ3ppcCBoZWFkZXIgbWV0aG9kIGFuZCBmbGFncyAoMCBpZiB6
bGliKSAqLwogICAgIHVuc2lnbmVkIGRtYXg7ICAgICAgICAgICAgICAvKiB6bGliIGhlYWRlciBt
YXggZGlzdGFuY2UgKElORkxBVEVfU1RSSUNUKSAqLwogICAgIHVuc2lnbmVkIGxvbmcgY2hlY2s7
ICAgICAgICAvKiBwcm90ZWN0ZWQgY29weSBvZiBjaGVjayB2YWx1ZSAqLwogICAgIHVuc2lnbmVk
IGxvbmcgdG90YWw7ICAgICAgICAvKiBwcm90ZWN0ZWQgY29weSBvZiBvdXRwdXQgY291bnQgKi8K
LSAvKiAgIGd6X2hlYWRlcnAgaGVhZDsgKi8gICAgICAgICAgIC8qIHdoZXJlIHRvIHNhdmUgZ3pp
cCBoZWFkZXIgaW5mb3JtYXRpb24gKi8KKyAgICAvKiBnel9oZWFkZXJwIGhlYWQ7ICovICAgICAg
Lyogd2hlcmUgdG8gc2F2ZSBnemlwIGhlYWRlciBpbmZvcm1hdGlvbiAqLwogICAgICAgICAvKiBz
bGlkaW5nIHdpbmRvdyAqLwogICAgIHVuc2lnbmVkIHdiaXRzOyAgICAgICAgICAgICAvKiBsb2cg
YmFzZSAyIG9mIHJlcXVlc3RlZCB3aW5kb3cgc2l6ZSAqLwogICAgIHVuc2lnbmVkIHdzaXplOyAg
ICAgICAgICAgICAvKiB3aW5kb3cgc2l6ZSBvciB6ZXJvIGlmIG5vdCB1c2luZyB3aW5kb3cgKi8K
ICAgICB1bnNpZ25lZCB3aGF2ZTsgICAgICAgICAgICAgLyogdmFsaWQgYnl0ZXMgaW4gdGhlIHdp
bmRvdyAqLwotICAgIHVuc2lnbmVkIHdyaXRlOyAgICAgICAgICAgICAvKiB3aW5kb3cgd3JpdGUg
aW5kZXggKi8KLSAgICB1bnNpZ25lZCBjaGFyICp3aW5kb3c7ICAvKiBhbGxvY2F0ZWQgc2xpZGlu
ZyB3aW5kb3csIGlmIG5lZWRlZCAqLworICAgIHVuc2lnbmVkIHduZXh0OyAgICAgICAgICAgICAv
KiB3aW5kb3cgd3JpdGUgaW5kZXggKi8KKyAgICB1bnNpZ25lZCBjaGFyICp3aW5kb3c7ICAgICAg
LyogYWxsb2NhdGVkIHNsaWRpbmcgd2luZG93LCBpZiBuZWVkZWQgKi8KICAgICAgICAgLyogYml0
IGFjY3VtdWxhdG9yICovCiAgICAgdW5zaWduZWQgbG9uZyBob2xkOyAgICAgICAgIC8qIGlucHV0
IGJpdCBhY2N1bXVsYXRvciAqLwogICAgIHVuc2lnbmVkIGJpdHM7ICAgICAgICAgICAgICAvKiBu
dW1iZXIgb2YgYml0cyBpbiAiaW4iICovCkBAIC05Niw4ICsxMDYsOCBAQCBzdHJ1Y3QgaW5mbGF0
ZV9zdGF0ZSB7CiAgICAgICAgIC8qIGZvciB0YWJsZSBhbmQgY29kZSBkZWNvZGluZyAqLwogICAg
IHVuc2lnbmVkIGV4dHJhOyAgICAgICAgICAgICAvKiBleHRyYSBiaXRzIG5lZWRlZCAqLwogICAg
ICAgICAvKiBmaXhlZCBhbmQgZHluYW1pYyBjb2RlIHRhYmxlcyAqLwotICAgIGNvZGUgY29uc3Qg
KmxlbmNvZGU7ICAgIC8qIHN0YXJ0aW5nIHRhYmxlIGZvciBsZW5ndGgvbGl0ZXJhbCBjb2RlcyAq
LwotICAgIGNvZGUgY29uc3QgKmRpc3Rjb2RlOyAgIC8qIHN0YXJ0aW5nIHRhYmxlIGZvciBkaXN0
YW5jZSBjb2RlcyAqLworICAgIGNvZGUgY29uc3QgKmxlbmNvZGU7ICAgICAgICAvKiBzdGFydGlu
ZyB0YWJsZSBmb3IgbGVuZ3RoL2xpdGVyYWwgY29kZXMgKi8KKyAgICBjb2RlIGNvbnN0ICpkaXN0
Y29kZTsgICAgICAgLyogc3RhcnRpbmcgdGFibGUgZm9yIGRpc3RhbmNlIGNvZGVzICovCiAgICAg
dW5zaWduZWQgbGVuYml0czsgICAgICAgICAgIC8qIGluZGV4IGJpdHMgZm9yIGxlbmNvZGUgKi8K
ICAgICB1bnNpZ25lZCBkaXN0Yml0czsgICAgICAgICAgLyogaW5kZXggYml0cyBmb3IgZGlzdGNv
ZGUgKi8KICAgICAgICAgLyogZHluYW1pYyB0YWJsZSBidWlsZGluZyAqLwpAQCAtMTA1LDE1ICsx
MTUsMTEgQEAgc3RydWN0IGluZmxhdGVfc3RhdGUgewogICAgIHVuc2lnbmVkIG5sZW47ICAgICAg
ICAgICAgICAvKiBudW1iZXIgb2YgbGVuZ3RoIGNvZGUgbGVuZ3RocyAqLwogICAgIHVuc2lnbmVk
IG5kaXN0OyAgICAgICAgICAgICAvKiBudW1iZXIgb2YgZGlzdGFuY2UgY29kZSBsZW5ndGhzICov
CiAgICAgdW5zaWduZWQgaGF2ZTsgICAgICAgICAgICAgIC8qIG51bWJlciBvZiBjb2RlIGxlbmd0
aHMgaW4gbGVuc1tdICovCi0gICAgY29kZSAqbmV4dDsgICAgICAgICAgICAgLyogbmV4dCBhdmFp
bGFibGUgc3BhY2UgaW4gY29kZXNbXSAqLworICAgIGNvZGUgKm5leHQ7ICAgICAgICAgICAgICAg
ICAvKiBuZXh0IGF2YWlsYWJsZSBzcGFjZSBpbiBjb2Rlc1tdICovCiAgICAgdW5zaWduZWQgc2hv
cnQgbGVuc1szMjBdOyAgIC8qIHRlbXBvcmFyeSBzdG9yYWdlIGZvciBjb2RlIGxlbmd0aHMgKi8K
ICAgICB1bnNpZ25lZCBzaG9ydCB3b3JrWzI4OF07ICAgLyogd29yayBhcmVhIGZvciBjb2RlIHRh
YmxlIGJ1aWxkaW5nICovCiAgICAgY29kZSBjb2Rlc1tFTk9VR0hdOyAgICAgICAgIC8qIHNwYWNl
IGZvciBjb2RlIHRhYmxlcyAqLworICAgIGludCBzYW5lOyAgICAgICAgICAgICAgICAgICAvKiBp
ZiBmYWxzZSwgYWxsb3cgaW52YWxpZCBkaXN0YW5jZSB0b28gZmFyICovCisgICAgaW50IGJhY2s7
ICAgICAgICAgICAgICAgICAgIC8qIGJpdHMgYmFjayBvZiBsYXN0IHVucHJvY2Vzc2VkIGxlbmd0
aC9saXQgKi8KKyAgICB1bnNpZ25lZCB3YXM7ICAgICAgICAgICAgICAgLyogaW5pdGlhbCBsZW5n
dGggb2YgbWF0Y2ggKi8KIH07Ci0KLS8qIFJldmVyc2UgdGhlIGJ5dGVzIGluIGEgMzItYml0IHZh
bHVlICovCi0jZGVmaW5lIFJFVkVSU0UocSkgXAotICAgICgoKChxKSA+PiAyNCkgJiAweGZmKSAr
ICgoKHEpID4+IDgpICYgMHhmZjAwKSArIFwKLSAgICAgKCgocSkgJiAweGZmMDApIDw8IDgpICsg
KCgocSkgJiAweGZmKSA8PCAyNCkpCi0KLSNlbmRpZgpkaWZmIC0tZ2l0IGEvbGliL3psaWJfaW5m
bGF0ZS9pbmZ0cmVlcy5jIGIvbGliL3psaWJfaW5mbGF0ZS9pbmZ0cmVlcy5jCmluZGV4IDAyODk0
MzA1MjkyNi4uYTNjNjQyMTZiNWM3IDEwMDY0NAotLS0gYS9saWIvemxpYl9pbmZsYXRlL2luZnRy
ZWVzLmMKKysrIGIvbGliL3psaWJfaW5mbGF0ZS9pbmZ0cmVlcy5jCkBAIC0xLDUgKzEsNSBAQAog
LyogaW5mdHJlZXMuYyAtLSBnZW5lcmF0ZSBIdWZmbWFuIHRyZWVzIGZvciBlZmZpY2llbnQgZGVj
b2RpbmcKLSAqIENvcHlyaWdodCAoQykgMTk5NS0yMDA1IE1hcmsgQWRsZXIKKyAqIENvcHlyaWdo
dCAoQykgMTk5NS0yMDE3IE1hcmsgQWRsZXIKICAqIEZvciBjb25kaXRpb25zIG9mIGRpc3RyaWJ1
dGlvbiBhbmQgdXNlLCBzZWUgY29weXJpZ2h0IG5vdGljZSBpbiB6bGliLmgKICAqLwogCkBAIC0z
NiwxMSArMzYsMTEgQEAgaW50IHpsaWJfaW5mbGF0ZV90YWJsZShjb2RldHlwZSB0eXBlLCB1bnNp
Z25lZCBzaG9ydCAqbGVucywgdW5zaWduZWQgY29kZXMsCiAgICAgdW5zaWduZWQgZmlsbDsgICAg
ICAgICAgICAgIC8qIGluZGV4IGZvciByZXBsaWNhdGluZyBlbnRyaWVzICovCiAgICAgdW5zaWdu
ZWQgbG93OyAgICAgICAgICAgICAgIC8qIGxvdyBiaXRzIGZvciBjdXJyZW50IHJvb3QgZW50cnkg
Ki8KICAgICB1bnNpZ25lZCBtYXNrOyAgICAgICAgICAgICAgLyogbWFzayBmb3IgbG93IHJvb3Qg
Yml0cyAqLwotICAgIGNvZGUgdGhpczsgICAgICAgICAgICAgICAgICAvKiB0YWJsZSBlbnRyeSBm
b3IgZHVwbGljYXRpb24gKi8KLSAgICBjb2RlICpuZXh0OyAgICAgICAgICAgICAvKiBuZXh0IGF2
YWlsYWJsZSBzcGFjZSBpbiB0YWJsZSAqLworICAgIGNvZGUgaGVyZTsgICAgICAgICAgICAgICAg
ICAvKiB0YWJsZSBlbnRyeSBmb3IgZHVwbGljYXRpb24gKi8KKyAgICBjb2RlICpuZXh0OyAgICAg
ICAgICAgICAgICAgLyogbmV4dCBhdmFpbGFibGUgc3BhY2UgaW4gdGFibGUgKi8KICAgICBjb25z
dCB1bnNpZ25lZCBzaG9ydCAqYmFzZTsgICAgIC8qIGJhc2UgdmFsdWUgdGFibGUgdG8gdXNlICov
CiAgICAgY29uc3QgdW5zaWduZWQgc2hvcnQgKmV4dHJhOyAgICAvKiBleHRyYSBiaXRzIHRhYmxl
IHRvIHVzZSAqLwotICAgIGludCBlbmQ7ICAgICAgICAgICAgICAgICAgICAvKiB1c2UgYmFzZSBh
bmQgZXh0cmEgZm9yIHN5bWJvbCA+IGVuZCAqLworICAgIHVuc2lnbmVkIG1hdGNoOyAgICAgICAg
ICAgICAvKiB1c2UgYmFzZSBhbmQgZXh0cmEgZm9yIHN5bWJvbCA+PSBtYXRjaCAqLwogICAgIHVu
c2lnbmVkIHNob3J0IGNvdW50W01BWEJJVFMrMV07ICAgIC8qIG51bWJlciBvZiBjb2RlcyBvZiBl
YWNoIGxlbmd0aCAqLwogICAgIHVuc2lnbmVkIHNob3J0IG9mZnNbTUFYQklUUysxXTsgICAgIC8q
IG9mZnNldHMgaW4gdGFibGUgZm9yIGVhY2ggbGVuZ3RoICovCiAgICAgc3RhdGljIGNvbnN0IHVu
c2lnbmVkIHNob3J0IGxiYXNlWzMxXSA9IHsgLyogTGVuZ3RoIGNvZGVzIDI1Ny4uMjg1IGJhc2Ug
Ki8KQEAgLTQ4LDcgKzQ4LDcgQEAgaW50IHpsaWJfaW5mbGF0ZV90YWJsZShjb2RldHlwZSB0eXBl
LCB1bnNpZ25lZCBzaG9ydCAqbGVucywgdW5zaWduZWQgY29kZXMsCiAgICAgICAgIDM1LCA0Mywg
NTEsIDU5LCA2NywgODMsIDk5LCAxMTUsIDEzMSwgMTYzLCAxOTUsIDIyNywgMjU4LCAwLCAwfTsK
ICAgICBzdGF0aWMgY29uc3QgdW5zaWduZWQgc2hvcnQgbGV4dFszMV0gPSB7IC8qIExlbmd0aCBj
b2RlcyAyNTcuLjI4NSBleHRyYSAqLwogICAgICAgICAxNiwgMTYsIDE2LCAxNiwgMTYsIDE2LCAx
NiwgMTYsIDE3LCAxNywgMTcsIDE3LCAxOCwgMTgsIDE4LCAxOCwKLSAgICAgICAgMTksIDE5LCAx
OSwgMTksIDIwLCAyMCwgMjAsIDIwLCAyMSwgMjEsIDIxLCAyMSwgMTYsIDIwMSwgMTk2fTsKKyAg
ICAgICAgMTksIDE5LCAxOSwgMTksIDIwLCAyMCwgMjAsIDIwLCAyMSwgMjEsIDIxLCAyMSwgMTYs
IDc3LCAyMDJ9OwogICAgIHN0YXRpYyBjb25zdCB1bnNpZ25lZCBzaG9ydCBkYmFzZVszMl0gPSB7
IC8qIERpc3RhbmNlIGNvZGVzIDAuLjI5IGJhc2UgKi8KICAgICAgICAgMSwgMiwgMywgNCwgNSwg
NywgOSwgMTMsIDE3LCAyNSwgMzMsIDQ5LCA2NSwgOTcsIDEyOSwgMTkzLAogICAgICAgICAyNTcs
IDM4NSwgNTEzLCA3NjksIDEwMjUsIDE1MzcsIDIwNDksIDMwNzMsIDQwOTcsIDYxNDUsCkBAIC0x
MDEsMTUgKzEwMSwxNSBAQCBpbnQgemxpYl9pbmZsYXRlX3RhYmxlKGNvZGV0eXBlIHR5cGUsIHVu
c2lnbmVkIHNob3J0ICpsZW5zLCB1bnNpZ25lZCBjb2RlcywKICAgICAgICAgaWYgKGNvdW50W21h
eF0gIT0gMCkgYnJlYWs7CiAgICAgaWYgKHJvb3QgPiBtYXgpIHJvb3QgPSBtYXg7CiAgICAgaWYg
KG1heCA9PSAwKSB7ICAgICAgICAgICAgICAgICAgICAgLyogbm8gc3ltYm9scyB0byBjb2RlIGF0
IGFsbCAqLwotICAgICAgICB0aGlzLm9wID0gKHVuc2lnbmVkIGNoYXIpNjQ7ICAgIC8qIGludmFs
aWQgY29kZSBtYXJrZXIgKi8KLSAgICAgICAgdGhpcy5iaXRzID0gKHVuc2lnbmVkIGNoYXIpMTsK
LSAgICAgICAgdGhpcy52YWwgPSAodW5zaWduZWQgc2hvcnQpMDsKLSAgICAgICAgKigqdGFibGUp
KysgPSB0aGlzOyAgICAgICAgICAgICAvKiBtYWtlIGEgdGFibGUgdG8gZm9yY2UgYW4gZXJyb3Ig
Ki8KLSAgICAgICAgKigqdGFibGUpKysgPSB0aGlzOworICAgICAgICBoZXJlLm9wID0gKHVuc2ln
bmVkIGNoYXIpNjQ7ICAgIC8qIGludmFsaWQgY29kZSBtYXJrZXIgKi8KKyAgICAgICAgaGVyZS5i
aXRzID0gKHVuc2lnbmVkIGNoYXIpMTsKKyAgICAgICAgaGVyZS52YWwgPSAodW5zaWduZWQgc2hv
cnQpMDsKKyAgICAgICAgKigqdGFibGUpKysgPSBoZXJlOyAgICAgICAgICAgICAvKiBtYWtlIGEg
dGFibGUgdG8gZm9yY2UgYW4gZXJyb3IgKi8KKyAgICAgICAgKigqdGFibGUpKysgPSBoZXJlOwog
ICAgICAgICAqYml0cyA9IDE7CiAgICAgICAgIHJldHVybiAwOyAgICAgLyogbm8gc3ltYm9scywg
YnV0IHdhaXQgZm9yIGRlY29kaW5nIHRvIHJlcG9ydCBlcnJvciAqLwogICAgIH0KLSAgICBmb3Ig
KG1pbiA9IDE7IG1pbiA8IE1BWEJJVFM7IG1pbisrKQorICAgIGZvciAobWluID0gMTsgbWluIDwg
bWF4OyBtaW4rKykKICAgICAgICAgaWYgKGNvdW50W21pbl0gIT0gMCkgYnJlYWs7CiAgICAgaWYg
KHJvb3QgPCBtaW4pIHJvb3QgPSBtaW47CiAKQEAgLTE1MiwxMSArMTUyLDEwIEBAIGludCB6bGli
X2luZmxhdGVfdGFibGUoY29kZXR5cGUgdHlwZSwgdW5zaWduZWQgc2hvcnQgKmxlbnMsIHVuc2ln
bmVkIGNvZGVzLAogICAgICAgIGVudGVyZWQgaW4gdGhlIHRhYmxlcy4KIAogICAgICAgIHVzZWQg
a2VlcHMgdHJhY2sgb2YgaG93IG1hbnkgdGFibGUgZW50cmllcyBoYXZlIGJlZW4gYWxsb2NhdGVk
IGZyb20gdGhlCi0gICAgICAgcHJvdmlkZWQgKnRhYmxlIHNwYWNlLiAgSXQgaXMgY2hlY2tlZCB3
aGVuIGEgTEVOUyB0YWJsZSBpcyBiZWluZyBtYWRlCi0gICAgICAgYWdhaW5zdCB0aGUgc3BhY2Ug
aW4gKnRhYmxlLCBFTk9VR0gsIG1pbnVzIHRoZSBtYXhpbXVtIHNwYWNlIG5lZWRlZCBieQotICAg
ICAgIHRoZSB3b3JzdCBjYXNlIGRpc3RhbmNlIGNvZGUsIE1BWEQuICBUaGlzIHNob3VsZCBuZXZl
ciBoYXBwZW4sIGJ1dCB0aGUKLSAgICAgICBzdWZmaWNpZW5jeSBvZiBFTk9VR0ggaGFzIG5vdCBi
ZWVuIHByb3ZlbiBleGhhdXN0aXZlbHksIGhlbmNlIHRoZSBjaGVjay4KLSAgICAgICBUaGlzIGFz
c3VtZXMgdGhhdCB3aGVuIHR5cGUgPT0gTEVOUywgYml0cyA9PSA5LgorICAgICAgIHByb3ZpZGVk
ICp0YWJsZSBzcGFjZS4gIEl0IGlzIGNoZWNrZWQgZm9yIExFTlMgYW5kIERJU1QgdGFibGVzIGFn
YWluc3QKKyAgICAgICB0aGUgY29uc3RhbnRzIEVOT1VHSF9MRU5TIGFuZCBFTk9VR0hfRElTVFMg
dG8gZ3VhcmQgYWdhaW5zdCBjaGFuZ2VzIGluCisgICAgICAgdGhlIGluaXRpYWwgcm9vdCB0YWJs
ZSBzaXplIGNvbnN0YW50cy4gIFNlZSB0aGUgY29tbWVudHMgaW4gaW5mdHJlZXMuaAorICAgICAg
IGZvciBtb3JlIGluZm9ybWF0aW9uLgogCiAgICAgICAgc3ltIGluY3JlbWVudHMgdGhyb3VnaCBh
bGwgc3ltYm9scywgYW5kIHRoZSBsb29wIHRlcm1pbmF0ZXMgd2hlbgogICAgICAgIGFsbCBjb2Rl
cyBvZiBsZW5ndGggbWF4LCBpLmUuIGFsbCBjb2RlcywgaGF2ZSBiZWVuIHByb2Nlc3NlZC4gIFRo
aXMKQEAgLTE2OCwxOSArMTY3LDE3IEBAIGludCB6bGliX2luZmxhdGVfdGFibGUoY29kZXR5cGUg
dHlwZSwgdW5zaWduZWQgc2hvcnQgKmxlbnMsIHVuc2lnbmVkIGNvZGVzLAogICAgIHN3aXRjaCAo
dHlwZSkgewogICAgIGNhc2UgQ09ERVM6CiAgICAgICAgIGJhc2UgPSBleHRyYSA9IHdvcms7ICAg
IC8qIGR1bW15IHZhbHVlLS1ub3QgdXNlZCAqLwotICAgICAgICBlbmQgPSAxOTsKKyAgICAgICAg
bWF0Y2ggPSAyMDsKICAgICAgICAgYnJlYWs7CiAgICAgY2FzZSBMRU5TOgogICAgICAgICBiYXNl
ID0gbGJhc2U7Ci0gICAgICAgIGJhc2UgLT0gMjU3OwogICAgICAgICBleHRyYSA9IGxleHQ7Ci0g
ICAgICAgIGV4dHJhIC09IDI1NzsKLSAgICAgICAgZW5kID0gMjU2OworICAgICAgICBtYXRjaCA9
IDI1NzsKICAgICAgICAgYnJlYWs7Ci0gICAgZGVmYXVsdDogICAgICAgICAgICAvKiBESVNUUyAq
LworICAgIGRlZmF1bHQ6ICAgIC8qIERJU1RTICovCiAgICAgICAgIGJhc2UgPSBkYmFzZTsKICAg
ICAgICAgZXh0cmEgPSBkZXh0OwotICAgICAgICBlbmQgPSAtMTsKKyAgICAgICAgbWF0Y2ggPSAw
OwogICAgIH0KIAogICAgIC8qIGluaXRpYWxpemUgc3RhdGUgZm9yIGxvb3AgKi8KQEAgLTE5NSwy
NCArMTkyLDI1IEBAIGludCB6bGliX2luZmxhdGVfdGFibGUoY29kZXR5cGUgdHlwZSwgdW5zaWdu
ZWQgc2hvcnQgKmxlbnMsIHVuc2lnbmVkIGNvZGVzLAogICAgIG1hc2sgPSB1c2VkIC0gMTsgICAg
ICAgICAgICAvKiBtYXNrIGZvciBjb21wYXJpbmcgbG93ICovCiAKICAgICAvKiBjaGVjayBhdmFp
bGFibGUgdGFibGUgc3BhY2UgKi8KLSAgICBpZiAodHlwZSA9PSBMRU5TICYmIHVzZWQgPj0gRU5P
VUdIIC0gTUFYRCkKKyAgICBpZiAoKHR5cGUgPT0gTEVOUyAmJiB1c2VkID4gRU5PVUdIX0xFTlMp
IHx8CisgICAgICAgICh0eXBlID09IERJU1RTICYmIHVzZWQgPiBFTk9VR0hfRElTVFMpKQogICAg
ICAgICByZXR1cm4gMTsKIAogICAgIC8qIHByb2Nlc3MgYWxsIGNvZGVzIGFuZCBtYWtlIHRhYmxl
IGVudHJpZXMgKi8KICAgICBmb3IgKDs7KSB7CiAgICAgICAgIC8qIGNyZWF0ZSB0YWJsZSBlbnRy
eSAqLwotICAgICAgICB0aGlzLmJpdHMgPSAodW5zaWduZWQgY2hhcikobGVuIC0gZHJvcCk7Ci0g
ICAgICAgIGlmICgoaW50KSh3b3JrW3N5bV0pIDwgZW5kKSB7Ci0gICAgICAgICAgICB0aGlzLm9w
ID0gKHVuc2lnbmVkIGNoYXIpMDsKLSAgICAgICAgICAgIHRoaXMudmFsID0gd29ya1tzeW1dOwor
ICAgICAgICBoZXJlLmJpdHMgPSAodW5zaWduZWQgY2hhcikobGVuIC0gZHJvcCk7CisgICAgICAg
IGlmICh3b3JrW3N5bV0gKyAxVSA8IG1hdGNoKSB7CisgICAgICAgICAgICBoZXJlLm9wID0gKHVu
c2lnbmVkIGNoYXIpMDsKKyAgICAgICAgICAgIGhlcmUudmFsID0gd29ya1tzeW1dOwogICAgICAg
ICB9Ci0gICAgICAgIGVsc2UgaWYgKChpbnQpKHdvcmtbc3ltXSkgPiBlbmQpIHsKLSAgICAgICAg
ICAgIHRoaXMub3AgPSAodW5zaWduZWQgY2hhcikoZXh0cmFbd29ya1tzeW1dXSk7Ci0gICAgICAg
ICAgICB0aGlzLnZhbCA9IGJhc2Vbd29ya1tzeW1dXTsKKyAgICAgICAgZWxzZSBpZiAod29ya1tz
eW1dID49IG1hdGNoKSB7CisgICAgICAgICAgICBoZXJlLm9wID0gKHVuc2lnbmVkIGNoYXIpKGV4
dHJhW3dvcmtbc3ltXSAtIG1hdGNoXSk7CisgICAgICAgICAgICBoZXJlLnZhbCA9IGJhc2Vbd29y
a1tzeW1dIC0gbWF0Y2hdOwogICAgICAgICB9CiAgICAgICAgIGVsc2UgewotICAgICAgICAgICAg
dGhpcy5vcCA9ICh1bnNpZ25lZCBjaGFyKSgzMiArIDY0KTsgICAgICAgICAvKiBlbmQgb2YgYmxv
Y2sgKi8KLSAgICAgICAgICAgIHRoaXMudmFsID0gMDsKKyAgICAgICAgICAgIGhlcmUub3AgPSAo
dW5zaWduZWQgY2hhcikoMzIgKyA2NCk7ICAgICAgICAgLyogZW5kIG9mIGJsb2NrICovCisgICAg
ICAgICAgICBoZXJlLnZhbCA9IDA7CiAgICAgICAgIH0KIAogICAgICAgICAvKiByZXBsaWNhdGUg
Zm9yIHRob3NlIGluZGljZXMgd2l0aCBsb3cgbGVuIGJpdHMgZXF1YWwgdG8gaHVmZiAqLwpAQCAt
MjIxLDcgKzIxOSw3IEBAIGludCB6bGliX2luZmxhdGVfdGFibGUoY29kZXR5cGUgdHlwZSwgdW5z
aWduZWQgc2hvcnQgKmxlbnMsIHVuc2lnbmVkIGNvZGVzLAogICAgICAgICBtaW4gPSBmaWxsOyAg
ICAgICAgICAgICAgICAgLyogc2F2ZSBvZmZzZXQgdG8gbmV4dCB0YWJsZSAqLwogICAgICAgICBk
byB7CiAgICAgICAgICAgICBmaWxsIC09IGluY3I7Ci0gICAgICAgICAgICBuZXh0WyhodWZmID4+
IGRyb3ApICsgZmlsbF0gPSB0aGlzOworICAgICAgICAgICAgbmV4dFsoaHVmZiA+PiBkcm9wKSAr
IGZpbGxdID0gaGVyZTsKICAgICAgICAgfSB3aGlsZSAoZmlsbCAhPSAwKTsKIAogICAgICAgICAv
KiBiYWNrd2FyZHMgaW5jcmVtZW50IHRoZSBsZW4tYml0IGNvZGUgaHVmZiAqLwpAQCAtMjYzLDcg
KzI2MSw4IEBAIGludCB6bGliX2luZmxhdGVfdGFibGUoY29kZXR5cGUgdHlwZSwgdW5zaWduZWQg
c2hvcnQgKmxlbnMsIHVuc2lnbmVkIGNvZGVzLAogCiAgICAgICAgICAgICAvKiBjaGVjayBmb3Ig
ZW5vdWdoIHNwYWNlICovCiAgICAgICAgICAgICB1c2VkICs9IDFVIDw8IGN1cnI7Ci0gICAgICAg
ICAgICBpZiAodHlwZSA9PSBMRU5TICYmIHVzZWQgPj0gRU5PVUdIIC0gTUFYRCkKKyAgICAgICAg
ICAgIGlmICgodHlwZSA9PSBMRU5TICYmIHVzZWQgPiBFTk9VR0hfTEVOUykgfHwKKyAgICAgICAg
ICAgICAgICAodHlwZSA9PSBESVNUUyAmJiB1c2VkID4gRU5PVUdIX0RJU1RTKSkKICAgICAgICAg
ICAgICAgICByZXR1cm4gMTsKIAogICAgICAgICAgICAgLyogcG9pbnQgZW50cnkgaW4gcm9vdCB0
YWJsZSB0byBzdWItdGFibGUgKi8KQEAgLTI3NCwzOCArMjczLDE0IEBAIGludCB6bGliX2luZmxh
dGVfdGFibGUoY29kZXR5cGUgdHlwZSwgdW5zaWduZWQgc2hvcnQgKmxlbnMsIHVuc2lnbmVkIGNv
ZGVzLAogICAgICAgICB9CiAgICAgfQogCi0gICAgLyoKLSAgICAgICBGaWxsIGluIHJlc3Qgb2Yg
dGFibGUgZm9yIGluY29tcGxldGUgY29kZXMuICBUaGlzIGxvb3AgaXMgc2ltaWxhciB0byB0aGUK
LSAgICAgICBsb29wIGFib3ZlIGluIGluY3JlbWVudGluZyBodWZmIGZvciB0YWJsZSBpbmRpY2Vz
LiAgSXQgaXMgYXNzdW1lZCB0aGF0Ci0gICAgICAgbGVuIGlzIGVxdWFsIHRvIGN1cnIgKyBkcm9w
LCBzbyB0aGVyZSBpcyBubyBsb29wIG5lZWRlZCB0byBpbmNyZW1lbnQKLSAgICAgICB0aHJvdWdo
IGhpZ2ggaW5kZXggYml0cy4gIFdoZW4gdGhlIGN1cnJlbnQgc3ViLXRhYmxlIGlzIGZpbGxlZCwg
dGhlIGxvb3AKLSAgICAgICBkcm9wcyBiYWNrIHRvIHRoZSByb290IHRhYmxlIHRvIGZpbGwgaW4g
YW55IHJlbWFpbmluZyBlbnRyaWVzIHRoZXJlLgotICAgICAqLwotICAgIHRoaXMub3AgPSAodW5z
aWduZWQgY2hhcik2NDsgICAgICAgICAgICAgICAgLyogaW52YWxpZCBjb2RlIG1hcmtlciAqLwot
ICAgIHRoaXMuYml0cyA9ICh1bnNpZ25lZCBjaGFyKShsZW4gLSBkcm9wKTsKLSAgICB0aGlzLnZh
bCA9ICh1bnNpZ25lZCBzaG9ydCkwOwotICAgIHdoaWxlIChodWZmICE9IDApIHsKLSAgICAgICAg
Lyogd2hlbiBkb25lIHdpdGggc3ViLXRhYmxlLCBkcm9wIGJhY2sgdG8gcm9vdCB0YWJsZSAqLwot
ICAgICAgICBpZiAoZHJvcCAhPSAwICYmIChodWZmICYgbWFzaykgIT0gbG93KSB7Ci0gICAgICAg
ICAgICBkcm9wID0gMDsKLSAgICAgICAgICAgIGxlbiA9IHJvb3Q7Ci0gICAgICAgICAgICBuZXh0
ID0gKnRhYmxlOwotICAgICAgICAgICAgdGhpcy5iaXRzID0gKHVuc2lnbmVkIGNoYXIpbGVuOwot
ICAgICAgICB9Ci0KLSAgICAgICAgLyogcHV0IGludmFsaWQgY29kZSBtYXJrZXIgaW4gdGFibGUg
Ki8KLSAgICAgICAgbmV4dFtodWZmID4+IGRyb3BdID0gdGhpczsKLQotICAgICAgICAvKiBiYWNr
d2FyZHMgaW5jcmVtZW50IHRoZSBsZW4tYml0IGNvZGUgaHVmZiAqLwotICAgICAgICBpbmNyID0g
MVUgPDwgKGxlbiAtIDEpOwotICAgICAgICB3aGlsZSAoaHVmZiAmIGluY3IpCi0gICAgICAgICAg
ICBpbmNyID4+PSAxOwotICAgICAgICBpZiAoaW5jciAhPSAwKSB7Ci0gICAgICAgICAgICBodWZm
ICY9IGluY3IgLSAxOwotICAgICAgICAgICAgaHVmZiArPSBpbmNyOwotICAgICAgICB9Ci0gICAg
ICAgIGVsc2UKLSAgICAgICAgICAgIGh1ZmYgPSAwOworICAgIC8qIGZpbGwgaW4gcmVtYWluaW5n
IHRhYmxlIGVudHJ5IGlmIGNvZGUgaXMgaW5jb21wbGV0ZSAoZ3VhcmFudGVlZCB0byBoYXZlCisg
ICAgICAgYXQgbW9zdCBvbmUgcmVtYWluaW5nIGVudHJ5LCBzaW5jZSBpZiB0aGUgY29kZSBpcyBp
bmNvbXBsZXRlLCB0aGUKKyAgICAgICBtYXhpbXVtIGNvZGUgbGVuZ3RoIHRoYXQgd2FzIGFsbG93
ZWQgdG8gZ2V0IHRoaXMgZmFyIGlzIG9uZSBiaXQpICovCisgICAgaWYgKGh1ZmYgIT0gMCkgewor
ICAgICAgICBoZXJlLm9wID0gKHVuc2lnbmVkIGNoYXIpNjQ7ICAgICAgICAgICAgLyogaW52YWxp
ZCBjb2RlIG1hcmtlciAqLworICAgICAgICBoZXJlLmJpdHMgPSAodW5zaWduZWQgY2hhcikobGVu
IC0gZHJvcCk7CisgICAgICAgIGhlcmUudmFsID0gKHVuc2lnbmVkIHNob3J0KTA7CisgICAgICAg
IG5leHRbaHVmZl0gPSBoZXJlOwogICAgIH0KIAogICAgIC8qIHNldCByZXR1cm4gcGFyYW1ldGVy
cyAqLwpkaWZmIC0tZ2l0IGEvbGliL3psaWJfaW5mbGF0ZS9pbmZ0cmVlcy5oIGIvbGliL3psaWJf
aW5mbGF0ZS9pbmZ0cmVlcy5oCmluZGV4IGI3MGI0NzMxYWM3YS4uZmU0MzA3ZmNmYmUzIDEwMDY0
NAotLS0gYS9saWIvemxpYl9pbmZsYXRlL2luZnRyZWVzLmgKKysrIGIvbGliL3psaWJfaW5mbGF0
ZS9pbmZ0cmVlcy5oCkBAIC0xLDggKzEsNSBAQAotI2lmbmRlZiBJTkZUUkVFU19ICi0jZGVmaW5l
IElORlRSRUVTX0gKLQogLyogaW5mdHJlZXMuaCAtLSBoZWFkZXIgdG8gdXNlIGluZnRyZWVzLmMK
LSAqIENvcHlyaWdodCAoQykgMTk5NS0yMDA1IE1hcmsgQWRsZXIKKyAqIENvcHlyaWdodCAoQykg
MTk5NS0yMDA1LCAyMDEwIE1hcmsgQWRsZXIKICAqIEZvciBjb25kaXRpb25zIG9mIGRpc3RyaWJ1
dGlvbiBhbmQgdXNlLCBzZWUgY29weXJpZ2h0IG5vdGljZSBpbiB6bGliLmgKICAqLwogCkBAIC0z
OCwyMiArMzUsMjggQEAgdHlwZWRlZiBzdHJ1Y3QgewogICAgIDAxMDAwMDAwIC0gaW52YWxpZCBj
b2RlCiAgKi8KIAotLyogTWF4aW11bSBzaXplIG9mIGR5bmFtaWMgdHJlZS4gIFRoZSBtYXhpbXVt
IGZvdW5kIGluIGEgbG9uZyBidXQgbm9uLQotICAgZXhoYXVzdGl2ZSBzZWFyY2ggd2FzIDE0NDQg
Y29kZSBzdHJ1Y3R1cmVzICg4NTIgZm9yIGxlbmd0aC9saXRlcmFscwotICAgYW5kIDU5MiBmb3Ig
ZGlzdGFuY2VzLCB0aGUgbGF0dGVyIGFjdHVhbGx5IHRoZSByZXN1bHQgb2YgYW4KLSAgIGV4aGF1
c3RpdmUgc2VhcmNoKS4gIFRoZSB0cnVlIG1heGltdW0gaXMgbm90IGtub3duLCBidXQgdGhlIHZh
bHVlCi0gICBiZWxvdyBpcyBtb3JlIHRoYW4gc2FmZS4gKi8KLSNkZWZpbmUgRU5PVUdIIDIwNDgK
LSNkZWZpbmUgTUFYRCA1OTIKKy8qIE1heGltdW0gc2l6ZSBvZiB0aGUgZHluYW1pYyB0YWJsZS4g
IFRoZSBtYXhpbXVtIG51bWJlciBvZiBjb2RlIHN0cnVjdHVyZXMgaXMKKyAgIDE0NDQsIHdoaWNo
IGlzIHRoZSBzdW0gb2YgODUyIGZvciBsaXRlcmFsL2xlbmd0aCBjb2RlcyBhbmQgNTkyIGZvciBk
aXN0YW5jZQorICAgY29kZXMuICBUaGVzZSB2YWx1ZXMgd2VyZSBmb3VuZCBieSBleGhhdXN0aXZl
IHNlYXJjaGVzIHVzaW5nIHRoZSBwcm9ncmFtCisgICBleGFtcGxlcy9lbm91Z2guYyBmb3VuZCBp
biB0aGUgemxpYiBkaXN0cmlidHV0aW9uLiAgVGhlIGFyZ3VtZW50cyB0byB0aGF0CisgICBwcm9n
cmFtIGFyZSB0aGUgbnVtYmVyIG9mIHN5bWJvbHMsIHRoZSBpbml0aWFsIHJvb3QgdGFibGUgc2l6
ZSwgYW5kIHRoZQorICAgbWF4aW11bSBiaXQgbGVuZ3RoIG9mIGEgY29kZS4gICJlbm91Z2ggMjg2
IDkgMTUiIGZvciBsaXRlcmFsL2xlbmd0aCBjb2RlcworICAgcmV0dXJucyByZXR1cm5zIDg1Miwg
YW5kICJlbm91Z2ggMzAgNiAxNSIgZm9yIGRpc3RhbmNlIGNvZGVzIHJldHVybnMgNTkyLgorICAg
VGhlIGluaXRpYWwgcm9vdCB0YWJsZSBzaXplICg5IG9yIDYpIGlzIGZvdW5kIGluIHRoZSBmaWZ0
aCBhcmd1bWVudCBvZiB0aGUKKyAgIGluZmxhdGVfdGFibGUoKSBjYWxscyBpbiBpbmZsYXRlLmMg
YW5kIGluZmJhY2suYy4gIElmIHRoZSByb290IHRhYmxlIHNpemUgaXMKKyAgIGNoYW5nZWQsIHRo
ZW4gdGhlc2UgbWF4aW11bSBzaXplcyB3b3VsZCBiZSBuZWVkIHRvIGJlIHJlY2FsY3VsYXRlZCBh
bmQKKyAgIHVwZGF0ZWQuICovCisjZGVmaW5lIEVOT1VHSF9MRU5TIDg1MgorI2RlZmluZSBFTk9V
R0hfRElTVFMgNTkyCisjZGVmaW5lIEVOT1VHSCAoRU5PVUdIX0xFTlMrRU5PVUdIX0RJU1RTKQog
Ci0vKiBUeXBlIG9mIGNvZGUgdG8gYnVpbGQgZm9yIGluZnRhYmxlKCkgKi8KKy8qIFR5cGUgb2Yg
Y29kZSB0byBidWlsZCBmb3IgaW5mbGF0ZV90YWJsZSgpICovCiB0eXBlZGVmIGVudW0gewogICAg
IENPREVTLAogICAgIExFTlMsCiAgICAgRElTVFMKIH0gY29kZXR5cGU7CiAKLWV4dGVybiBpbnQg
emxpYl9pbmZsYXRlX3RhYmxlIChjb2RldHlwZSB0eXBlLCB1bnNpZ25lZCBzaG9ydCAqbGVucywK
K2ludCB6bGliX2luZmxhdGVfdGFibGUgKGNvZGV0eXBlIHR5cGUsIHVuc2lnbmVkIHNob3J0ICps
ZW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCBjb2RlcywgY29kZSAq
KnRhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bnNpZ25lZCAqYml0cywgdW5z
aWduZWQgc2hvcnQgKndvcmspOwotI2VuZGlmCi0tIAoyLjMxLjEuMzY1LmdhMmEwNWEzOWM1Cgo=
--000000000000a2b63c05c1707ab9--
