Return-Path: <linux-arch-owner@vger.kernel.org>
X-Original-To: lists+linux-arch@lfdr.de
Delivered-To: lists+linux-arch@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id CB2372873DE
	for <lists+linux-arch@lfdr.de>; Thu,  8 Oct 2020 14:13:53 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1729635AbgJHMNu (ORCPT <rfc822;lists+linux-arch@lfdr.de>);
        Thu, 8 Oct 2020 08:13:50 -0400
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:35630 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1725871AbgJHMNu (ORCPT
        <rfc822;linux-arch@vger.kernel.org>); Thu, 8 Oct 2020 08:13:50 -0400
Received: from mail-pg1-x542.google.com (mail-pg1-x542.google.com [IPv6:2607:f8b0:4864:20::542])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 03BAEC061755
        for <linux-arch@vger.kernel.org>; Thu,  8 Oct 2020 05:13:49 -0700 (PDT)
Received: by mail-pg1-x542.google.com with SMTP id r10so4116157pgb.10
        for <linux-arch@vger.kernel.org>; Thu, 08 Oct 2020 05:13:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=date:message-id:from:to:cc:subject:in-reply-to:references
         :user-agent:mime-version;
        bh=E4i4TAbPbSHDVJHnFcTQOnENpeJVidGjACENiuA3KpI=;
        b=EYpxaTDnluu560c3mXtaHt+EgtwB7dausx5V9mfWsFggtEDnx1hFNYJsx0ShAsH7LB
         a5XX6cZmtRsTMa6oDEQeLZtgUyi+d8bJs59ZpmnlDiHQt/XkakQKEdSA93juk67Ad24v
         IWYGbtoRkNpWQhtaIGowxnd5s86U/nP/eXSy7rlX3BZvxHsAZimE5L8wBNUz2AlP9zJ3
         REc/BIJ60CoEIDW7qOhEEH38mSw9NOMJmuK92c55UmIKpiY7ISF4YnCBiGDvPsU8UPOe
         4KJC8XJ35wcgsYtr7WiT00ljTpTDqqnsIqxWaKtDurT2aYoqCaENJVRO3bIzLlcmP3lM
         9RYQ==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:date:message-id:from:to:cc:subject:in-reply-to
         :references:user-agent:mime-version;
        bh=E4i4TAbPbSHDVJHnFcTQOnENpeJVidGjACENiuA3KpI=;
        b=iuo718fOnYIzUW3esJKLOhj34xQ+RHCX7fA+6Rz2NYRZ5ZOdDgYHiscCRNeg2l+nEX
         7Fn9LQyWfbYelxUuU18/F/6Gwf5xL0IzSwhsU5e1VZx/52mDv+UU/1j2/5RuQrIHIcqs
         4ez2znPZzm2JIb3mHqxIqqV62WmyTaBebhOk30yQ3L0V70Db8Jg8pT8EdL5dPvyhXbNx
         mjnlv1mb2R0vvaiE965hAw4xph688ojvuJqepmvCC93cwnYX6C6i71yUe+0GQEIErqij
         7Vc2rwQfoFiOeNhOsK5IZDSpUKlxMk8YAhNSbAM2unZVEIb6WtkDktG7WZVYsHo1/V9H
         +FcA==
X-Gm-Message-State: AOAM532voi4ctgdriH+PD1XLkEUSRADEeYRnMeBnU0fkkmUWHVSOu+8D
        5ceEpOZW/RolScX/Vwexbhw=
X-Google-Smtp-Source: ABdhPJzv5GDUu3ksFlm5eoeeSfMNOwegfMq+FtCNfe0GOoHoOU1JTTux2UN60ZYrMw3Huvl6HVDbDg==
X-Received: by 2002:a17:90a:9f91:: with SMTP id o17mr8038435pjp.228.1602159228365;
        Thu, 08 Oct 2020 05:13:48 -0700 (PDT)
Received: from earth-mac.local.gmail.com (219x123x138x129.ap219.ftth.ucom.ne.jp. [219.123.138.129])
        by smtp.gmail.com with ESMTPSA id t9sm7086583pfc.205.2020.10.08.05.13.45
        (version=TLS1_2 cipher=ECDHE-ECDSA-CHACHA20-POLY1305 bits=256/256);
        Thu, 08 Oct 2020 05:13:47 -0700 (PDT)
Date:   Thu, 08 Oct 2020 21:13:43 +0900
Message-ID: <m21ri86hl4.wl-thehajime@gmail.com>
From:   Hajime Tazaki <thehajime@gmail.com>
To:     anton.ivanov@cambridgegreys.com
Cc:     linux-um@lists.infradead.org, jdike@addtoit.com, richard@nod.at,
        tavi.purdila@gmail.com, linux-kernel-library@freelists.org,
        linux-arch@vger.kernel.org, retrage01@gmail.com
Subject: Re: [RFC v7 21/21] um: nommu: add block device support of UML
In-Reply-To: <ac66cd8b-3bb1-5846-aa75-fc91c1149e91@cambridgegreys.com>
References: <cover.1601960644.git.thehajime@gmail.com>
        <a8686efcbad3c445d3e5bde054c04a58877915f1.1601960644.git.thehajime@gmail.com>
        <ac66cd8b-3bb1-5846-aa75-fc91c1149e91@cambridgegreys.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/25.3 Mule/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Precedence: bulk
List-ID: <linux-arch.vger.kernel.org>
X-Mailing-List: linux-arch@vger.kernel.org


On Wed, 07 Oct 2020 23:17:31 +0900,
Anton Ivanov wrote:

> > diff --git a/arch/um/nommu/um/Kconfig b/arch/um/nommu/um/Kconfig
> > index 20b3eaccb6f0..c6a3f472fe75 100644
> > --- a/arch/um/nommu/um/Kconfig
> > +++ b/arch/um/nommu/um/Kconfig
> > @@ -4,6 +4,10 @@ config UML_NOMMU
> >   	select UACCESS_MEMCPY
> >   	select ARCH_THREAD_STACK_ALLOCATOR
> >   	select ARCH_HAS_SYSCALL_WRAPPER
> > +	select VFAT_FS
> > +	select NLS_CODEPAGE_437
> > +	select NLS_ISO8859_1
> > +	select BTRFS_FS
> >     config 64BIT
> >   	bool
> > @@ -35,3 +39,7 @@ config STACKTRACE_SUPPORT
> >   config PRINTK_TIME
> >   	bool
> >   	default y
> > +
> > +config RAID6_PQ_BENCHMARK
> > +	bool
> > +	default n
> 
> Why are we touching this? I thought this is already defined in lib/Kconfig?

With the scheduler which LKL implements, it has the same issue with
what time-travel=inf-cpu has when CONFIG_BTRFS_FS is enable.  I tried
to follow the way of the commit d65197a (below), but if I added
"depends on !RAID6_PQ_BENCHMARK" to config UMMODE_LIB, I got "error:
recursive dependency detected!".

https://github.com/thehajime/linux/commit/d65197ad52494bed3b5e64708281b8295f76c391#diff-c170aa964ad412630a2b5addf306ff14

Thus, to avoid this situation, I did the above additional config
RAID6_PQ_BENCHMARK just for UMMODE_LIB.

I plan to rework on Kconfig (UMMODE_LIB and !MMU) and will figure out
more appropriate way.

-- Hajime

