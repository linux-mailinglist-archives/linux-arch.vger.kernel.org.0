Return-Path: <linux-arch-owner@vger.kernel.org>
X-Original-To: lists+linux-arch@lfdr.de
Delivered-To: lists+linux-arch@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id 2C3471532C4
	for <lists+linux-arch@lfdr.de>; Wed,  5 Feb 2020 15:24:38 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1726597AbgBEOYh (ORCPT <rfc822;lists+linux-arch@lfdr.de>);
        Wed, 5 Feb 2020 09:24:37 -0500
Received: from mail-pg1-f193.google.com ([209.85.215.193]:44393 "EHLO
        mail-pg1-f193.google.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S1726575AbgBEOYh (ORCPT
        <rfc822;linux-arch@vger.kernel.org>); Wed, 5 Feb 2020 09:24:37 -0500
Received: by mail-pg1-f193.google.com with SMTP id g3so1031327pgs.11
        for <linux-arch@vger.kernel.org>; Wed, 05 Feb 2020 06:24:37 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=date:message-id:from:to:cc:subject:in-reply-to:references
         :user-agent:mime-version;
        bh=gbABLLE49n2yhiqkhSn8nnzWORWiC6z8xKar+HwA+/I=;
        b=kg9Sn1pw4Iy6kPtWetppxrrt4YP1d+5khQ0zkoZYHFVlc4p203SjJdSTLjWvKWGNYr
         hmJtlobvFf48bqS37P5P1KkIKaop68XlaghavmaJCBBAXJ/GPwgkkDNyr0NTDcyHKbaQ
         h570jiYesTw2owj+r8izawRPmMZMwnzNbixeQ582Ak0PLKsyaiVGQW2rmXXkNuB2zaQa
         pBgPUtZxi4bjAWfefpEAGL0YclSVACs8wmteb2EPjKkwZCSwHvXv1mm9X48NZrpS9e9O
         qgJhw6HkszEP6dH0W3czrRAmHC/VPmAmFXsTb5Cw+P731J4oEG3Wy27NH/uG1jTPR4An
         ZDrw==
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=1e100.net; s=20161025;
        h=x-gm-message-state:date:message-id:from:to:cc:subject:in-reply-to
         :references:user-agent:mime-version;
        bh=gbABLLE49n2yhiqkhSn8nnzWORWiC6z8xKar+HwA+/I=;
        b=Q9+sUTZVJjdW7/23pk9WuQ3+gno6zZaYFF9q0Az8UUsWc5sWqMt6RsLVDkNmZs7FQC
         Ag7wC+3kUXr9t+UWevmhAeJBzc79fbUzGtCgYBmkOHU49ntEsrSQRxA4XKVYnznGLlhK
         R6xOVVAEV5YIFTTojy2vAjTuufmrBTe2EwjaIscPJ8QcJqcmgZan5kHbsD66ajjX3bl+
         0puCLqEKlhadzcTipX5dKFDfZI+F/f+FKvKLwmidJdhe+6DtKythmaskeyHwintp6Jf+
         Z4RaUF91JZVaWAZZLL9DdEfrWUay/7xxtNzXEoT4nVDF33Ny99QPRZfo5PdkGhZ2GXt5
         tJiw==
X-Gm-Message-State: APjAAAXsAExEq5fmsQjq9yjdXlt+61vn44sfXJUMVv/fmfhEUaYmcrGf
        O3YuD6ccUN6FHnPzmD3bFYf3idgWz+YtyA==
X-Google-Smtp-Source: APXvYqzTM3SLLErn34QMZLRJfB84dU6EKiA3BC7oP1plFtsaxKPOXcUkvi3tdkYenkCKSexDkzubAA==
X-Received: by 2002:a63:2c0e:: with SMTP id s14mr625716pgs.349.1580912676621;
        Wed, 05 Feb 2020 06:24:36 -0800 (PST)
Received: from earth-mac.local.gmail.com (219x123x138x129.ap219.ftth.ucom.ne.jp. [219.123.138.129])
        by smtp.gmail.com with ESMTPSA id z16sm4170449pgl.92.2020.02.05.06.24.33
        (version=TLS1_2 cipher=ECDHE-RSA-CHACHA20-POLY1305 bits=256/256);
        Wed, 05 Feb 2020 06:24:34 -0800 (PST)
Date:   Wed, 05 Feb 2020 23:24:29 +0900
Message-ID: <m2ftfpqfhe.wl-thehajime@gmail.com>
From:   Hajime Tazaki <thehajime@gmail.com>
To:     anton.ivanov@kot-begemot.co.uk
Cc:     richard.weinberger@gmail.com, linux-arch@vger.kernel.org,
        tavi.purdila@gmail.com, linux-um@lists.infradead.org,
        retrage01@gmail.com, linux-kernel-library@freelists.org,
        sigmaepsilon92@gmail.com
Subject: Re: [RFC v2 07/37] lkl: interrupt support
In-Reply-To: <739ada9a-b88a-5192-fb4b-65132a74b4de@kot-begemot.co.uk>
References: <cover.1573179553.git.thehajime@gmail.com>
        <567fd4d5c395e2279e86ca0bfca544ad2773a31d.1573179553.git.thehajime@gmail.com>
        <CAFLxGvxytmS4WSFj2ibyJKCuR5TbspdNf6MvHNvzh9dtKx2rJg@mail.gmail.com>
        <m2h805qy99.wl-thehajime@gmail.com>
        <739ada9a-b88a-5192-fb4b-65132a74b4de@kot-begemot.co.uk>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) Emacs/25.3 Mule/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-arch-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-arch.vger.kernel.org>
X-Mailing-List: linux-arch@vger.kernel.org


Hello Anton,

On Wed, 05 Feb 2020 19:49:37 +0900,
Anton Ivanov wrote:

> >>>   arch/um/lkl/include/asm/irq.h             |  13 ++
> >>>   arch/um/lkl/include/uapi/asm/irq.h        |  36 ++++
> >>>   arch/um/lkl/include/uapi/asm/sigcontext.h |  16 ++
> >>>   arch/um/lkl/kernel/irq.c                  | 193 ++++++++++++++++++++++
> >> 
> >> Like I said before, this also something to unify with UML.
> >> I'm aware that this is easily said but we cannot have too much duplication.
> >> 
> >> Feel free to ask if UML internals give you headache. :-)
> > 
> > Same as nommu implementation, I left this part as-is.
> > 
> > Triggering interrupts with fd events (delivered by epoll&co) is a hard
> > part to implement host-independent interrupts of LKL.  OTOH, the v3
> > patchset shows that it is doable to use UML drivers with the LKL
> > interrupt facility.
> 
> Make sure you are testing with the vector network devices, the
> legacy ones are scheduled to be obsoleted at some point

I was aware of the commit to obsolete several backend with the vector
device, but did not include in the patchset and tests.  I will try to
do it for the next round.

> I know this will cause a headache on non-Linux, I am happy to write
> wrappers/emulators for recvmms/sendmmsg so these build on the
> systems which do not support them.

If UML is going to extend to support non-Linux host, yes, those kind
of wrappers will be helpful.

Right now, the patchset only focuses on x86 hosts so, this can be
postponed.

-- Hajime

